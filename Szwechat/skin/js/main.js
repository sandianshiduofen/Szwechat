var timerBottom,api=apiL=wxApi(),apiAn=wxApiAn(),apiAnY=wxApiAnY(),wxApiHai=wxApiHai(),apiZhao=wxApiZhao(),apiHaiL=apiHaiL(),sess=sessionStorage,appid=appid(),redirect_uri=redirectUri();function wecatLoading(){var code=GetQueryString("code");if(code&&!sess.code){var callbackUrl=window.location.pathname;sess.loginUrl=callbackUrl,loading("加载中..."),$.ajax({url:api+"/api/wx/login/applogin",type:"POST",dataType:"json",timeout:1e4,data:{code:code,requestTokenId:requestTokenId()},success:function(data){if(data.success){sess.code=code;var info=data.info;if(null!=data.info)if("null"==info.user){var Nickname=(new Base64).encode(info.Nickname);window.location.href="../../login/login_select.html?Headimgurl="+info.Headimgurl+"&Nickname="+Nickname+"&unionid="+info.unionid}else if(info.user){var user=JSON.parse(info.user);if(1==user.userState&&1==user.accountState)return $.MsgBox.Confirmt("对不起，您的账号异常，暂不能登录，请联系客服：4001-821200","拨打电话","关闭",function(){WeixinJSBridge.call("closeWindow")},function(){window.location.href="tel:4001821200",WeixinJSBridge.call("closeWindow")}),!1;if(1==user.userState&&"/ucenter/ucenter.html"!=callbackUrl)return $.MsgBox.Confirmt("对不起，您的账号已被封停，封停原因："+user.userFreezeReason+"，如有疑问，请联系客服：4001-821200","拨打电话","关闭",function(){WeixinJSBridge.call("closeWindow")},function(){window.location.href="tel:4001821200",WeixinJSBridge.call("closeWindow")}),!1;var result=(new Base64).encode(info.user);sess.info=result,"/ucenter/ucenter.html"==window.location.pathname?(loading("loading..."),finduser()):"/order/send_out.html"==window.location.pathname?sendLoginAddr():"/order/self_help_order.html"==window.location.pathname?self_load():window.location.href=sess.loginUrl}else $(".previewimg").remove(),document.write("登录失败，请关闭重新登录");else window.location.href="../login/not_login.html"}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($("body"),400,"请求超时，请返回重新再试","wecatLoading()"):"timeout"==status&&noResultErr($("body"),400,"请求超时，请返回重新再试","wecatLoading()")}})}}function fengting(){var userFreezeReason=$('[name="userFreezeReason"]').val();$.MsgBox.Confirmt("对不起，您的账号已被封停，封停原因："+userFreezeReason+"，如有疑问，请联系客服：4001-821200","拨打电话","关闭",function(){return!1},function(){window.location.href="tel:4001821200"})}function pushHistory(){window.history.pushState({title:"title",url:"#"},"title","")}function popstate(){pushHistory();var bool=!1;setTimeout(function(){bool=!0},1e3),window.addEventListener("popstate",function(e){bool&&WeixinJSBridge.call("closeWindow"),pushHistory()},!1)}function popstateUc(){pushHistory();var bool=!1;setTimeout(function(){bool=!0},1e3),window.addEventListener("popstate",function(e){bool&&(window.location.href="../../ucenter/account.html"),pushHistory()},!1)}function popstateUcenter(){pushHistory();var bool=!1;setTimeout(function(){bool=!0},1e3),window.addEventListener("popstate",function(e){bool&&(window.location.href="../../ucenter/ucenter.html"),pushHistory()},!1)}function wxApi(){return"http://pweixinapi.3zqp.com"}function wxApiAn(){return"http://ptms.3zqp.com"}function wxApiAnY(){return"http://ptms.3zqp.com"}function wxApiHai(){return"http://ptmsimg.3zqp.com"}function imgShowApi(){return"https://3zxgimg.oss-cn-beijing.aliyuncs.com/"}function wxApiZhao(){return"http://pappapi.3zqp.com"}function apiHaiL(){return"http://pacc.3zqp.com"}function appid(){return"wx9d37162460f921d8"}function redirectUri(){return"http://192.168.0.73"}function isWeiXin(){return"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)}function userId(){if(sess.info){var result=(new Base64).decode(sess.info);return JSON.parse(result).id}}function userTel(){if(sess.info){var result=(new Base64).decode(sess.info);return JSON.parse(result).tel}}function userName(){if(sess.info){var result=(new Base64).decode(sess.info);return JSON.parse(result).userName}}function number(){if(sess.info){var result=(new Base64).decode(sess.info);return JSON.parse(result).number}}function account(){if(sess.info){var result=(new Base64).decode(sess.info);return JSON.parse(result).account}}function type(){if(sess.info){var result=(new Base64).decode(sess.info);return JSON.parse(result).type}}function requestTokenId(num){len=num||32;var $chars="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",maxPos=$chars.length,pwd="";for(i=0;i<len;i++)pwd+=$chars.charAt(Math.floor(Math.random()*maxPos));return"wx_tms_"+pwd}function requestTokenInput(){var html='<input name="requestTokenId" type="hidden" value="'+requestTokenId()+'">';$("form").append(html)}function clipboard(){var clipboard=new Clipboard(".details_btn");clipboard.on("success",function(e){$(".waybill_wrap").css("display","none")}),clipboard.on("error",function(e){alert("失败")})}function headerGoback(){history.back(-1)}function showRem(msg){$(".reminder").remove(),$("body").append('<div class="reminder"><p>'+msg+"</p></div>");var timer=setTimeout(function(){clearTimeout(timer),$(".reminder").fadeOut(500),$(".reminder").remove()},3e3)}function addr_aera2(pNum,cNum,dNum){var city_picker=new mui.PopPicker({layer:3});if(city_picker.setData(provs),pNum&&cNum&&dNum){for(var i=0;i<provs.length;i++){var PIndex=i;if(provs[i].value==pNum){for(var j=0;j<provs.length;j++){var cIndex=j;if(cNum==provs[i].child[j].value){for(var k=0;k<provs[i].child[j].child.length;k++){var dIndex=k;if(dNum==provs[i].child[j].child[k].value)break}break}}break}}city_picker.pickers[0].setSelectedIndex(PIndex),city_picker.pickers[1].setSelectedIndex(cIndex),city_picker.pickers[2].setSelectedIndex(dIndex)}$("#addr_aera").on("tap",function(){$("input").blur(),setTimeout(function(){city_picker.show(function(items){$("#addr_value").val((items[0]||{}).value+","+(items[1]||{}).value+","+(items[2].value||items[1].value)),$("#addr_aera").removeClass("c999").html((items[0]||{}).text+" "+(items[1]||{}).text+" "+(items[2].text||items[1].text))})},200)})}function sub_tel(e){if(PhoneNo($('[name="tel"]'))){loading("获取中...");var lonin_tel=$('[name="tel"]').val();$.ajax({url:apiL+"/api/wx/validation/getcode",type:"POST",dataType:"json",data:{phone:lonin_tel,type:0,requestTokenId:requestTokenId()},success:function(data){loadingRemove(),data.success?(e.removeAttr("onclick").html('<span id="dao_time">60</span>秒再次获取'),countDown("#dao_time",60)):alert(data.message)}})}}function countDown(e,num){num=num;var timer=setInterval(function(){num--,$(e).html(num),0==num&&($(".gain").attr("onclick","sub_tel($(this))").html("获取验证码"),clearInterval(timer))},1e3)}function telSubmit(){if(!PhoneNo($(".tel")))return PhoneNo($(".tel")),!1;if(!verify($(".yzm")))return verify($(".yzm")),!1;if(!password($('[name="password"]')))return password($('[name="password"]')),!1;if(!password2($('[name="password2"]')))return password2($('[name="password2"]')),!1;if($('[name="protocol"]:checked').length<1)return alert("请您先勾选同意《三真车联平台注册协议》"),!1;$(".footer_btn").attr("disabled","disabled");var timer=setTimeout(function(){clearTimeout(timer),$(".footer_btn").removeAttr("disabled")},5e3);loading("提交中...");var login_tel=$('[name="tel"]').val(),login_code=$('[name="code"]').val(),login_psw=$("[name=password]").val(),unionid=GetQueryString("uid"),data={unionid:unionid,phone:login_tel,code:login_code,password:login_psw,username:login_tel,registerType:3,requestTokenId:requestTokenId()};$.ajax({url:api+"/api/wx/login/register",type:"POST",dataType:"json",data:data,success:function(data){if(loadingRemove(),data.success)if(data.message)alert(data.message);else{console.log(data);var info=(new Base64).encode(JSON.stringify(data.info));sess.info=info;var result=(new Base64).decode(sess.info),json=JSON.parse(result);console.log(json),window.location.href="../login/login_addr.html?unionid="+unionid}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?($(".footer_btn").removeAttr("disabled"),fubottom("提交失败，请重试")):"timeout"==status&&($(".footer_btn").removeAttr("disabled"),fubottom("提交失败，请重试"))}})}function protocolClose(){$(".protocol_wrap").css("display","none")}function protocolSelect(){$('[name="protocol"]').attr("checked","checked"),$(".protocol_wrap").css("display","none")}function addrSubmit(){if(!noNullfa($(".company"),"公司名称"))return noNullfa($(".company"),"公司名称"),!1;if(!nameLen($('[name="name"]').val()))return nameLen($('[name="name"]').val()),!1;if(!noNull($("#addr_value"),"所在地址"))return noNull($("#addr_value"),"所在地址"),!1;if(!noNullfa($(".addr_detail"),"详细地址"))return noNullfa($(".addr_detail"),"详细地址"),!1;$(".footer_btn").attr("disabled","disabled");var timer=setTimeout(function(){clearTimeout(timer),$(".footer_btn").removeAttr("disabled")},5e3);loading("提交中...");var company=trim($('[name="company"]').val()),name=trim($('[name="name"]').val()),addrAera=$("#addr_aera").html(),addrAeraNum=$('[name="addrAeraNum"]').val(),addrDetail=trim($('[name="addrDetail"]').val());addrAera=addrAera.split(" "),addrAeraNum=addrAeraNum.split(",");userName();AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(addrAera[0]+""+addrAera[1]+addrAera[2]+addrDetail,function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("提交中...");var data={id:userId(),company:company,proName:addrAera[0],proNumber:addrAeraNum[0],cityName:addrAera[1],cityNumber:addrAeraNum[1],areaName:addrAera[2],areaNumber:addrAeraNum[2],detailed:addrDetail,lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,contact:name,tel:userTel(),type:3,account:account(),number:number(),userName:userName(),unionid:GetQueryString("unionid"),requestTokenId:requestTokenId()};console.log(data),$.ajax({url:apiL+"/api/wx/login/adduser",type:"POST",dataType:"json",data:data,success:function(data){if(loadingRemove(),data.success){var info=data.info;if(null!=info){info=JSON.stringify(info);var result=(new Base64).encode(info);sess.info=result}window.location.href="../login/login_ok.html"}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?($(".footer_btn").removeAttr("disabled"),fubottom("提交失败，请重试")):"timeout"==status&&($(".footer_btn").removeAttr("disabled"),fubottom("提交失败，请重试"))}})}else AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(addrAera[0]+""+addrAera[1]+addrAera[2],function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("提交中...");var data={id:userId(),company:company,proName:addrAera[0],proNumber:addrAeraNum[0],cityName:addrAera[1],cityNumber:addrAeraNum[1],areaName:addrAera[2],areaNumber:addrAeraNum[2],detailed:addrDetail,lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,contact:name,tel:userTel(),type:3,account:account(),number:number(),userName:userName(),unionid:GetQueryString("unionid"),requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/login/adduser",type:"POST",dataType:"json",data:data,success:function(data){if(loadingRemove(),data.success){var info=data.info;if(null!=info){info=JSON.stringify(info);var result=(new Base64).encode(info);sess.info=result}window.location.href="../login/login_ok.html"}else alert(data.message)}})}else $.MsgBox.Alert("地址获取失败，请重试或修改地址后再试","确定")})})})})}function login_ok(e,time){userId()||(window.location.href="../login/login_tel.html");var i=parseFloat(time)/1e3;0<i?setInterval(function(){i--,e.html(i)},1e3):e.html(0),setTimeout(function(){window.location.href=sess.loginUrl},time)}function loginBindSubmit(){var callbackUrl=sess.loginUrl;if(noNull($('[name="account"]'),"账号"))if(noNull($('[name="password"]'),"密码")){loading("绑定中...");var login_tel=$('[name="account"]').val(),login_psw=$('[name="password"]').val();$.ajax({url:api+"/api/wx/login/relation",type:"POST",dataType:"json",data:{username:login_tel,password:login_psw,unionid:GetQueryString("uid"),requestTokenId:requestTokenId()},success:function(data){if(loadingRemove(),data.success)if(data.message)alert(data.message);else{var user=data.info;if(1==user.userState&&1==user.accountState)return $.MsgBox.Confirmt("对不起，您的账号异常，暂不能登录，请联系客服：4001-821200","拨打电话","关闭",function(){WeixinJSBridge.call("closeWindow")},function(){window.location.href="tel:4001821200",WeixinJSBridge.call("closeWindow")}),!1;if(1==user.userState&&"/ucenter/ucenter.html"!=callbackUrl){var result=(new Base64).encode(JSON.stringify(data.info));return sess.info=result,alert("绑定成功"),$.MsgBox.Confirmt("对不起，您的账号已被封停，封停原因："+user.userFreezeReason+"。您可以进入<a class='blue' href='/ucenter/ucenter.html'>个人中心</a>。如有疑问，请联系客服：4001-821200","拨打电话","关闭",function(){WeixinJSBridge.call("closeWindow")},function(){window.location.href="tel:4001821200",WeixinJSBridge.call("closeWindow")}),!1}result=(new Base64).encode(JSON.stringify(data.info));sess.info=result,window.location.href=sess.loginUrl}else alert(data.message)}})}else $(".msg").html('<span class="red">密码不能为空</span>');else $(".msg").html('<span class="red">账号不能为空</span>')}function noNull(e,msg){return 0==trim(e.val()).length?($(".msg").html('<span class="red">'+msg+"不能为空</span>"),!1):($(".msg").html(""),!0)}function noNullfa(e,msg){var val=trim(e.val());return 0==val.length?($(".msg").html('<span class="red">'+msg+"不能为空</span>"),!1):notdot(val)?($(".msg").html('<span class="red">'+msg+"不能输入非法字符</span>"),!1):($(".msg").html(""),!0)}function trim(str){return str.replace(/ /g,"")}function nameLen(value){return value?hanEng(value)?value.length<2||20<value.length?($(".msg").html('<span class="red">联系人需输入2-20个字</span>'),!1):($(".msg").html(""),!0):($(".msg").html('<span class="red">联系人姓名只能中英文</span>'),!1):($(".msg").html(""),!0)}function password(e){var val=e.val(),val2=$('[name="password2"]').val();return 0==val.length?($(".msg").html('<span class="red">密码不能为空</span>'),!1):ispsw(val)?0!=val2.length&&val2!=val?($(".msg").html('<span class="red">两次输入的密码不一致</span>'),!1):($(".msg").html(""),!0):($(".msg").html('<span class="red">请输入6-16位数字和字母的组合密码</span>'),!1)}function password2(e){var val=e.val(),val2=$('[name="password"]').val();return 0==val.length?($(".msg").html('<span class="red">重复密码不能为空</span>'),!1):ispsw(val)?0!=val2.length&&val2!=val?($(".msg").html('<span class="red">两次输入的密码不一致</span>'),!1):($(".msg").html(""),!0):($(".msg").html('<span class="red">请输入重复6-16位数字和字母的组合密码</span>'),!1)}function telNo(e){return isNumberTel(trim(e.val()))?($(".msg").html(""),!0):(loadingRemove(),$(".msg").html('<span class="red">请输入7-12位的手机号或固话</span>'),!1)}function telNoFa(e){return isNumberTel(trim(e.val()))?($(".msg_fuInputTel").html(""),!0):(loadingRemove(),$(".msg_fuInputTel").html('<span class="red">请输入7-12位的手机号或固话</span>'),!1)}function PhoneNo(e){var val=e.val();return 0==val.length?($(".msg").html('<span class="red">手机号不能为空</span>'),!1):isPhoneNo(val)?($(".msg").html(""),!0):($(".msg").html('<span class="red">请输入正确的手机号</span>'),!1)}function comPhoneNo(e){var val=trim(e.val());return 0==val.length?(e.parents(".comment_input").siblings(".msg").html('<span class="red">手机号不能为空</span>'),!1):isPhoneNo(val)?(e.parents(".comment_input").siblings(".msg").html(""),!0):(e.parents(".comment_input").siblings(".msg").html('<span class="red">请输入正确的手机号</span>'),!1)}function verify(e){var val=e.val();return 0==val.length?($(".msg").html('<span class="red">验证码不能为空</span>'),!1):istelverify(val)?($(".msg").html(""),!0):($(".msg").html('<span class="red">请输入正确的验证码</span>'),!1)}function isPhoneNo(phone){return/^1\d{10}$/.test(phone)}function istelverify(verify){return/^\d{4,7}$/.test(verify)}function isNumberTel(tel){return/^\d{7,12}$/.test(tel)}function ispsw(psw){return/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,16}$/.test(psw)}function hanEng(psw){return/^[\u4E00-\u9FA5A-Za-z]+$/.test(psw)}function notdot(stry){return new RegExp("[`~!@#$^&*=|{}':;',\\[\\].<>/?！@#￥……&*|{}‘；：”“'。，？]").test(stry)}function consignerEdit(id){GetQueryString("waybill")?window.location.href="../ucenter/consigner_edit.html?edit="+id+"&from=addr&waybill=addr&order="+GetQueryString("selfHp"):window.location.href="../ucenter/consigner_edit.html?edit="+id+"&from=addr&order="+GetQueryString("selfHp")}function recrivingEdit(id){GetQueryString("waybill")?window.location.href="../ucenter/receiving_edit.html?edit="+id+"&from=addr&waybill=addr&order="+GetQueryString("selfHp"):window.location.href="../ucenter/receiving_edit.html?edit="+id+"&from=addr&order="+GetQueryString("selfHp")}function GetQueryString(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)"),r=window.location.search.substr(1).match(reg);return null!=r?unescape(r[2]):null}function GetQueryString2(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)"),r=window.location.search.substr(1).match(reg);return null!=r?unescape(r[1]):null}function getRequest(){var url=window.location.search,theRequest=new Object;if(-1!=url.indexOf("?")){var str=url.substr(1);strs=str.split("&");for(var i=0;i<strs.length;i++)theRequest[strs[i].split("=")[0]]=decodeURI(strs[i].split("=")[1])}return theRequest}function loading(text){var html='<div class="loadingZhuan"><div class="loadingZ"><img src="../skin/images/zhuan.gif"><p>'+text+"</p></div></div>";$("body").append(html)}function loadingRemove(){$(".loadingZhuan").remove()}function displayB(e){e.css("display","flex")}function displayN(e){e.css("display","none")}function toDecimal2(x){var f=parseFloat(x);if(isNaN(f))return!1;var s=(f=Math.round(100*x)/100).toString(),rs=s.indexOf(".");for(rs<0&&(rs=s.length,s+=".");s.length<=rs+2;)s+="0";return s}function fubottom(text){if(clearTimeout(timerBottom),0<$("body .fubottom").length){$(".fubottom").fadeOut().remove();var html='<div class="fubottom">'+text+"</div>";$("body").append(html).fadeIn()}else{html='<div class="fubottom">'+text+"</div>";$("body").append(html).fadeIn()}timerBottom=setTimeout(function(){$(".fubottom").fadeOut().remove()},2e3)}function noResult(boxDot,height,text){boxDot.html('<div class="noResult_flex" style="height:'+height+'px"><div class="noResult_flex"><div class="noResult_c"><span><img src="../skin/images/no_find.png" alt=""></span><p>'+text+"</p></div></div>")}function noResultErr(boxDot,height,text,func){boxDot.html('<div class="noResult_flex" style="height:'+height+'px"><div class="noResult_flex" onclick="'+func+'"><div class="noResult_c"><span><img src="../skin/images/loading_erro.png" alt=""></span><p>'+text+"</p></div></div>")}$(function(){wecatLoading();var shou=window.location.pathname;isWeiXin()||"/order/share.html"==shou?isWeiXin()||"/order/share.html"!=shou||$(".header_box").remove():window.location.href="../login/not_login.html","/order/share.html"!=shou&&"/shop/share.html"!=shou&&document.addEventListener("WeixinJSBridgeReady",function(){WeixinJSBridge.call("hideOptionMenu")});var u=navigator.userAgent;navigator.appVersion,-1<u.indexOf("Android")||u.indexOf("Adr");!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&$(".header_box").remove(),$("input[readonly]").on("focus",function(){$(this).trigger("blur")})}),Date.prototype.format=function(format){var date={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S+":this.getMilliseconds()};for(var k in/(y+)/i.test(format)&&(format=format.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),date)new RegExp("("+k+")").test(format)&&(format=format.replace(RegExp.$1,1==RegExp.$1.length?date[k]:("00"+date[k]).substr((""+date[k]).length)));return format};