"use strict";function consignerShow(){if(userId()){var edit=GetQueryString("edit"),add=GetQueryString("add");GetQueryString("waybill");edit?$.ajax({url:apiL+"/api/wx/address/findedit",type:"get",dataType:"json",data:{id:edit,type:1,requestTokenId:requestTokenId()},success:function(data){data.success?($('[name="client"]').val(data.info.company),$('[name="name"]').val(data.info.contact),$('[name="tel"]').val(data.info.phone),$("#addr_aera").html(data.info.proName+" "+data.info.cityName+" "+data.info.areaName).removeClass("c999"),$('[name="detail"]').val(data.info.detailed),$('[name="aeraNum"]').val(data.info.proNumber+","+data.info.cityNumber+","+data.info.areaNumber),data.info.isDefault?$(".tacitly_approve").html('<label><input type="checkbox" checked="checked" name="default"><span class="checkbox"></span><b id="">设为默认发货方</b></label>'):$(".tacitly_approve").html('<label><input type="checkbox" name="default"><span class="checkbox"></span><b id="">设为默认发货方</b></label>'),addr_aera2(data.info.proNumber,data.info.cityNumber,data.info.areaNumber)):alert(data.message)}}):(addr_aera2(),document.title="新增发货方",add&&"addr"==add&&$(".tacitly_approve").find("input").attr("checked","checked"),add||$(".tacitly_approve").find("input").attr("checked","checked"))}else window.location.href="../login/not_login.html"}function deliveryShow(){if(userId()){var edit=GetQueryString("edit");GetQueryString("id");edit?$.ajax({url:apiL+"/api/wx/address/findedit",type:"get",dataType:"json",data:{id:edit,type:2,requestTokenId:requestTokenId()},success:function(data){data.success?($('[name="client"]').val(data.info.company),$('[name="name"]').val(data.info.contact),$('[name="tel"]').val(data.info.phone),$("#addr_aera").html(data.info.proName+" "+data.info.cityName+" "+data.info.areaName).removeClass("c999"),$('[name="detail"]').val(data.info.detailed),$('[name="aeraNum"]').val(data.info.proNumber+","+data.info.cityNumber+","+data.info.areaNumber),addr_aera2(data.info.proNumber,data.info.cityNumber,data.info.areaNumber)):alert(data.message)}}):(addr_aera2(),document.title="新增收货方")}else window.location.href="../login/not_login.html"}function del_addr(e,id){confirm("确定要删除吗？")&&$.ajax({url:apiL+"/api/wx/address/findedit",type:"post",dataType:"json",data:{id:id,type:1,requestTokenId:requestTokenId()},success:function(data){var isDefault=data.info.isDefault;data.success?$.ajax({url:apiL+"/api/wx/address/delete",type:"post",dataType:"json",data:{id:edit,type:1,userId:userId(),isDefault:isDefault,requestTokenId:requestTokenId()},success:function(data1){data1.success?(e.parents(".record_li").remove(),0==$(".ship_li").length&&$(".record_list").html('<div class="ship_nofind"><span><img src="../skin/images/no_find.png" alt=""></span><p>对不起，您还没有添加地址</p></div>')):alert(data1.message)}}):alert(data.message)}})}function consignerSubmit(){if(!noNullfa($('[name="client"]'),"单位名称"))return noNullfa($('[name="client"]'),"单位名称"),!1;if(!nameLen($('[name="name"]').val()))return nameLen($('[name="name"]').val()),!1;if(!PhoneNo($('[name="tel"]')))return PhoneNo($('[name="tel"]')),!1;if(!noNull($('[name="aeraNum"]'),"所在省、市、区"))return noNull($('[name="aeraNum"]'),"所在省、市、区"),!1;if(!noNullfa($('[name="detail"]'),"详细地址"))return noNullfa($('[name="detail"]'),"详细地址"),!1;var mycan=GetQueryString("order");window.location.href=null!=mycan&&1==mycan?"../order/self_help_order.html":"../ucenter/ucenter.html"}function shipSubmit(){if(!noNullfa($('[name="client"]'),"单位名称"))return noNullfa($('[name="client"]'),"单位名称"),!1;if(!nameLen($('[name="name"]').val()))return nameLen($('[name="name"]').val()),!1;if(!telNo($('[name="tel"]')))return telNo($('[name="tel"]')),!1;if(!noNull($('[name="aeraNum"]'),"所在省、市、区"))return noNull($('[name="aeraNum"]'),"所在省、市、区"),!1;if(!noNullfa($('[name="detail"]'),"详细地址"))return noNullfa($('[name="detail"]'),"详细地址"),!1;loading("保存中...");var edit=GetQueryString("edit");if(edit){var company=trim($('[name="client"]').val()),contact=trim($('[name="name"]').val()),phone=trim($('[name="tel"]').val()),aera=$("#addr_aera").html(),aeraNum=$('[name="aeraNum"]').val(),detailed=trim($('[name="detail"]').val()),aeraArr=aera.split(" "),aeraNumArr=aeraNum.split(","),isDefault="";isDefault=0<$('[name="default"]:checked').length?1:0,AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2]+detailed,function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("保存中...");var data={userId:userId(),type:1,id:edit,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],detailed:detailed,lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,isDefault:isDefault,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/edit",type:"post",timeout:1e4,dataType:"json",data:data,success:function(data){loadingRemove(),data.success?(console.log(data),window.location.href="../ucenter/ship_address.html"):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?alert("修改失败请重新提交"):"timeout"==status&&alert("修改失败请重新提交")}}),$(".footer_btn").attr("disabled","disabled");var timer=setTimeout(function(){clearTimeout(timer),$(".footer_btn").removeAttr("disabled")},5e3)}else AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2],function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("保存中...");var data={userId:userId(),type:1,id:edit,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],detailed:detailed,lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,isDefault:isDefault,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/edit",type:"post",timeout:1e4,dataType:"json",data:data,success:function(data){loadingRemove(),data.success?window.location.href="../ucenter/ship_address.html":alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?alert("修改失败请重新提交"):"timeout"==status&&alert("修改失败请重新提交")}}),$(".footer_btn").attr("disabled","disabled");var timer=setTimeout(function(){clearTimeout(timer),$(".footer_btn").removeAttr("disabled")},5e3)}else $.MsgBox.Alert("地址获取失败，请重试或修改地址后再试","确定")})})})})}else{company=trim($('[name="client"]').val()),contact=trim($('[name="name"]').val()),phone=$('[name="tel"]').val(),aera=$("#addr_aera").html(),aeraNum=$('[name="aeraNum"]').val(),detailed=trim($('[name="detail"]').val()),aeraArr=aera.split(" "),aeraNumArr=aeraNum.split(",");AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2]+detailed,function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("保存中...");var data={userId:userId(),type:1,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,detailed:detailed,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/add",type:"get",dataType:"json",data:data,success:function(data){loadingRemove(),data.success?window.location.href="../ucenter/ship_address.html":alert(data.message)}}),$(".footer_btn").attr("disabled","disabled");var timer=setTimeout(function(){clearTimeout(timer),$(".footer_btn").removeAttr("disabled")},5e3)}else AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2],function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("保存中...");var data={userId:userId(),type:1,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,detailed:detailed,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/add",type:"get",dataType:"json",data:data,success:function(data){loadingRemove(),data.success?window.location.href="../ucenter/ship_address.html":alert(data.message)}}),$(".footer_btn").attr("disabled","disabled");var timer=setTimeout(function(){clearTimeout(timer),$(".footer_btn").removeAttr("disabled")},5e3)}else $.MsgBox.Alert("地址获取失败，请重试或修改地址后再试","确定")})})})})}}function receivingSubmit(){if(!noNullfa($('[name="client"]'),"单位名称"))return noNullfa($('[name="client"]'),"单位名称"),!1;if(!nameLen($('[name="name"]').val()))return nameLen($('[name="name"]').val()),!1;if(!telNo($('[name="tel"]')))return telNo($('[name="tel"]')),!1;if(!noNull($('[name="aeraNum"]'),"所在省、市、区"))return noNull($('[name="aeraNum"]'),"所在省、市、区"),!1;if(!noNullfa($('[name="detail"]'),"详细地址"))return noNullfa($('[name="detail"]'),"详细地址"),!1;loading("保存中...");var edit=GetQueryString("edit");if(edit){var company=trim($('[name="client"]').val()),contact=trim($('[name="name"]').val()),phone=trim($('[name="tel"]').val()),aera=$("#addr_aera").html(),aeraNum=$('[name="aeraNum"]').val(),detailed=trim($('[name="detail"]').val()),aeraArr=aera.split(" "),aeraNumArr=aeraNum.split(",");AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2]+detailed,function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("保存中...");var data={userId:userId(),type:2,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],detailed:detailed,id:edit,lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,isDefault:0,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/edit",type:"post",dataType:"json",data:data,success:function(data){loadingRemove(),data.success?window.location.href="../ucenter/receiving_party.html":alert(data.message)}}),$(".footer_btn").attr("disabled","disabled");var timer=setTimeout(function(){clearTimeout(timer),$(".footer_btn").removeAttr("disabled")},5e3)}else AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2],function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("保存中...");var data={userId:userId(),type:2,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],detailed:detailed,id:edit,lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,isDefault:0,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/edit",type:"post",dataType:"json",data:data,success:function(data){loadingRemove(),data.success?window.location.href="../ucenter/receiving_party.html":alert(data.message)}}),$(".footer_btn").attr("disabled","disabled");var timer=setTimeout(function(){clearTimeout(timer),$(".footer_btn").removeAttr("disabled")},5e3)}else $.MsgBox.Alert("地址获取失败，请重试或修改地址后再试","确定")})})})})}else{company=trim($('[name="client"]').val()),contact=trim($('[name="name"]').val()),phone=trim($('[name="tel"]').val()),aera=$("#addr_aera").html(),aeraNum=$('[name="aeraNum"]').val(),detailed=trim($('[name="detail"]').val()),aeraArr=aera.split(" "),aeraNumArr=aeraNum.split(",");AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2]+detailed,function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("保存中...");var data={userId:userId(),type:2,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,detailed:detailed,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/add",type:"post",dataType:"json",data:data,success:function(data){loadingRemove(),data.success?window.location.href="../ucenter/receiving_party.html":alert(data.message)}}),$(".footer_btn").attr("disabled","disabled");var timer=setTimeout(function(){clearTimeout(timer),$(".footer_btn").removeAttr("disabled")},5e3)}else AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2],function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("保存中...");var data={userId:userId(),type:2,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,detailed:detailed,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/add",type:"post",dataType:"json",data:data,success:function(data){loadingRemove(),data.success?window.location.href="../ucenter/receiving_party.html":alert(data.message)}}),$(".footer_btn").attr("disabled","disabled");var timer=setTimeout(function(){clearTimeout(timer),$(".footer_btn").removeAttr("disabled")},5e3)}else $.MsgBox.Alert("地址获取失败，请重试或修改地址后再试","确定")})})})})}}