"use strict";function mount_hint(){$("body").append('<div id="mb_box" style="width: 100%; height: 100%; z-index: 99999; position: fixed; background-color: black; top: 0px; left: 0px; opacity: 0.6;"></div><div id="mb_con" style="z-index: 999999; width: 80%; position: fixed; background-color: white; top: 50%; left: 36px;margin-top:-1.5rem;"><div id="mb_msg2" style="padding: 20px; line-height: 20px; border-bottom: 1px solid rgb(226, 226, 226);"><p style="margin-bottom:0.1rem;">1、可提现金额：可通过“提现”功能，提现到银行卡的金额。</p><p style="margin-bottom:0.1rem;">2、保护期金额：订单已签收，系统分账金额等待银行结算中，结算后即成为可用金额</p><p>3、总金额：可提现金额+保护期金额=总金额</p></div><div id="mb_btnbox" style="text-align: center;"><input id="mb_btn_ok_a" type="button" value="我知道了" style="width: 100%; height: 50px; color: rgb(126, 211, 33); border: none; float: left;"onclick="$(\'#mb_box,#mb_con\').remove()"></div></div>')}function accountAcc(){loading("加载中..."),$.ajax({url:api+"/api/wx/account/bank/list",type:"POST",dataType:"json",data:{account:account(),requestTokenId:requestTokenId()},success:function(data){if(loadingRemove(),accountClose(),data.success){if(null!=data.info)if($("#extractAmount").html(toDecimal2(data.info.extractAmount)),$("#guardAmount").html(toDecimal2(data.info.guardAmount)),$("#sumAmount").html(toDecimal2(data.info.sumAmount)),null==data.info.bankNo)$("#myBindBand").attr("href","../ucenter/tel_code.html").append('<b class="red">未绑定</b>');else if($("#myBindBand").attr("href","../ucenter/tel_code.html").append('<b class="green">已绑定</b>'),$("#myBindBand").attr("href","../ucenter/bank_card.html"),data.info.password){$(".my_account").append('<li class="my_ac_ka"><a href="../ucenter/pay_psw.html"><p><span>安全密码</span> <br>用于提现转账安全验证</p><b class="green">已设置</b></a></li>')}}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?$.MsgBox.Confirmt("请求超时，获取账户失败，</br>重新获取或跳到上一页","重新获取","上一页",function(){window.location.href="ucenter.html"},function(){accountAcc()}):"timeout"==status&&$.MsgBox.Confirmt("请求超时，获取账户失败，</br>重新获取或跳到上一页","重新获取","上一页",function(){window.location.href="ucenter.html"},function(){accountAcc()})}})}function accountClose(){$.ajax({url:apiL+"/api/wx/login/finduser",type:"post",dataType:"json",data:{id:userId(),requestTokenId:requestTokenId()},success:function(data){if(data.success){if(1==data.info.accountState){var html='<div class="act_remind"><a href="javascript:;" onclick="$.MsgBox.Alert(\'您的账户已冻结</br>冻结原因：'+data.info.accountFreezeReason+"</br>如有疑问，联系客服：<a class=blue href=tel:4000000120>4000001200</a>','确定')\">您的账号已被冻结，冻结原因："+data.info.accountFreezeReason+"</a></div>";$("#act_remind_w").html(html)}}else alert(data.message)}})}function withdraw(){$.ajax({url:api+"/api/wx/account/bank/list",type:"POST",dataType:"json",data:{account:account(),requestTokenId:requestTokenId()},success:function(data){data.success?null==data.info.bankNo?$.MsgBox.Confirmt("您还未添加银行卡，前往设置","去设置","取消",function(){},function(){window.location.href="../ucenter/tel_code.html"}):window.location.href="../ucenter/withdraw.html":alert(data.message)}})}function isverify(verify){return/^\d{1,8}(\.\d{1,2})?$/.test(verify)}function passwordOpen(){var amount=$('[name="amount"]').val(),keyongAmount=parseFloat($("#extractAmount").html());amount?isverify(amount)?(loading("loading..."),$.ajax({url:api+"/api/wx/login/finduser",type:"POST",dataType:"json",data:{id:userId(),requestTokenId:requestTokenId()},success:function(data){if(loadingRemove(),data.success){if(1==data.info.accountState)return $("#mb_box,#mb_con").remove(),$.MsgBox.Confirmt("对不起，您的账户已被冻结，冻结原因："+data.info.accountFreezeReason+"，如有疑问，请联系客服：4001-821200","拨打电话","关闭",function(){return!1},function(){window.location.href="tel:4001821200"}),!1;loading("loading..."),$.ajax({url:api+"/api/wx/account/findpoundage",type:"POST",data:{requestTokenId:requestTokenId()},dataType:"json",success:function(data){loadingRemove(),data.success?null!=data.info?amount>=data.info.takeMaxMoney?alert("每笔最大提现金额需小于"+data.info.takeMaxMoney+"元"):amount<=data.info.takePoundageMoney?0==amount?alert("提现金额必须大于0哦~"):alert("提现金额必须大于手续费哦~"):keyongAmount<amount?alert("提现金额不得大于可用余额"):$(".receive_pop_w").css("display","block"):keyongAmount<amount?alert("提现金额不得大于可用余额"):$(".receive_pop_w").css("display","block"):alert(data.message)}})}else alert(data.message)}})):alert("请输入正确的价格,小数点后不大于两位数"):alert("请输入正确的提现金额")}function Bandname(value){return value?hanEng(value)?value.length<2||20<value.length?($(".msg").html('<span class="red">开户人姓名需输入2-20个字</span>'),!1):($(".msg").html(""),!0):($(".msg").html('<span class="red">开户人姓名只能中英文</span>'),!1):($(".msg").html(""),!0)}function billFilt(){$(".supernatant_w").fadeIn(),$(".supernatant_r").animate({right:0},300)}function billFiltBack(){$(".supernatant_w").fadeOut(),$(".supernatant_r").animate({right:"-90%"},300)}function billFiltReset(){$('[name="type"]').removeAttr("checked"),$('[name="time"]').val("")}function codeSubmit(){var code=$('[name="code"]');if(verify(code)){loading("提交中");var codeVal=code.val();GetQueryString("find")?$.ajax({url:api+"/api/wx/account/findverificationbycode",type:"POST",dataType:"json",data:{code:codeVal,userName:userName(),type:3,requestTokenId:requestTokenId()},success:function(data){data.success?window.location.href="../ucenter/psw_find.html?edit=1":alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("提交失败，请重试"):"timeout"==status&&fubottom("提交失败，请重试")}}):$.ajax({url:api+"/api/wx/account/findverificationbycode",type:"POST",dataType:"json",data:{code:codeVal,userName:userName(),type:2,requestTokenId:requestTokenId()},success:function(data){data.success?window.location.href="../ucenter/bank_bind.html":alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("提交失败，请重试"):"timeout"==status&&fubottom("提交失败，请重试")}})}else verify(code)}function creditCardVerify(verify){return/^\d{16,19}$/.test(verify)}function creditCard(e){var val=e.val();return val&&creditCardVerify(val)?($(".msg").html(""),!0):($(".msg").html('<span class="red">请输入正确的银行卡号</span>'),!1)}function bankCardType(text){16==text.length?(creditCard($('[name="bankCard"]')),$.ajax({url:api+"/api/wx/account/ownedbank/list",type:"POST",dataType:"json",data:{bank:text,requestTokenId:requestTokenId()},success:function(data){data.success?data.info?($("#bankOwned").removeClass("red").html(data.info.bankname),$('[name="bankOwned"]').val(data.info.bankname)):($("#bankOwned").addClass("red").html("没有匹配到银行类型"),$('[name="bankOwned"]').val("")):(alert(data.message),$('[name="bankOwned"]').val(""))},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?($("#mb_con,#mb_box").remove(),$.MsgBox.Confirmt("银行卡类型获取失败，请重输银行卡号或重新获取","重新获取","关闭",function(){return!1},function(){bankCardTypeR($('[name="bankCard"]').val())})):"timeout"==status&&($("#mb_con,#mb_box").remove(),$.MsgBox.Confirmt("银行卡类型获取失败，请重输银行卡号或重新获取","重新获取","关闭",function(){return!1},function(){bankCardTypeR($('[name="bankCard"]').val())}))}})):text.length<16&&($('[name="bankOwned"]').val(""),$("#bankOwned").removeClass("red").html(""))}function bankCardTypeR(text){$.ajax({url:api+"/api/wx/account/ownedbank/list",type:"POST",dataType:"json",data:{bank:text,requestTokenId:requestTokenId()},success:function(data){data.success?data.info?($("#bankOwned").removeClass("red").html(data.info.bankname),$('[name="bankOwned"]').val(data.info.bankname)):($("#bankOwned").addClass("red").html("没有匹配到银行类型"),$('[name="bankOwned"]').val("")):(alert(data.message),$('[name="bankOwned"]').val(""))},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?($("#mb_con,#mb_box").remove(),$.MsgBox.Confirmt("银行卡类型获取失败，请重输银行卡号或重新获取","重新获取","关闭",function(){return!1},function(){bankCardTypeR($('[name="bankCard"]').val())})):"timeout"==status&&($("#mb_con,#mb_box").remove(),$.MsgBox.Confirmt("银行卡类型获取失败，请重输银行卡号或重新获取","重新获取","关闭",function(){return!1},function(){bankCardTypeR($('[name="bankCard"]').val())}))}})}function bankSubmit(){if(!creditCard($('[name="bankCard"]')))return creditCard($('[name="bankCard"]')),!1;if(!Bandname($('[name="name"]').val()))return Bandname($('[name="name"]').val()),!1;if(!$('[name="bankOwned"]').val())return $(".msg").html('<span class="red">没有匹配到银行类型</span>'),!1;if(0==$('[name="protocol"]:checked').length)return alert("请您阅读并同意《银行卡用户服务协议》"),!1;loading("保存中...");var editBink=GetQueryString("editBink"),bankNo=$('[name="bankCard"]').val(),bankName=$('[name="name"]').val(),bankOwned=$('[name="bankOwned"]').val();if(editBink){var data={role:type(),account:account(),bankNo:bankNo,bankName:bankName,bankOwned:bankOwned,requestTokenId:requestTokenId()};$.ajax({url:api+"/api/wx/account/bank/edit",type:"POST",dataType:"json",data:data,success:function(data){loadingRemove(),data.success?window.location.href="../ucenter/bank_success.html":alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?$.MsgBox.Alert("提交失败，请重新提交","确定"):"timeout"==status&&$.MsgBox.Alert("提交失败，请重新提交","确定")}})}else window.location.href="../../ucenter/bank_psw.html?cardNum="+bankNo+"&cardName="+bankName+"&bankOwned="+bankOwned}function isPswPay(psw){return/^\d{6}$/.test(psw)}function passwordPay(e){var val=e.val(),val2=$('[name="password2"]').val();return 0==val.length?($(".msg").html('<span class="red">密码不能为空</span>'),!1):isPswPay(val)?0!=val2.length&&val2!=val?($(".msg").html('<span class="red">两次输入的密码不一致</span>'),!1):($(".msg").html(""),!0):($(".msg").html('<span class="red">请输入6位纯数字安全密码</span>'),!1)}function passwordPay2(e){var val=e.val(),val2=$('[name="password"]').val();return 0==val.length?($(".msg").html('<span class="red">重复密码不能为空</span>'),!1):isPswPay(val)?0!=val2.length&&val2!=val?($(".msg").html('<span class="red">两次输入的密码不一致</span>'),!1):($(".msg").html(""),!0):($(".msg").html('<span class="red">请重复输入6位纯数字安全密码</span>'),!1)}function PayPswSubmit(){if(!passwordPay($('[name="password"]')))return passwordPay($('[name="password"]')),!1;if(!passwordPay2($('[name="password2"]')))return passwordPay2($('[name="password2"]')),!1;loading("提交中...");var cardNum=getRequest().cardNum,cardName=getRequest().cardName,bankOwned=getRequest().bankOwned,password=$('[name="password"]').val();cardNum?$.ajax({url:api+"/api/wx/account/passwordandbank/add",type:"POST",dataType:"json",data:{role:3,account:account(),bankNo:cardNum,bankName:cardName,bankOwned:bankOwned,password:password,requestTokenId:requestTokenId()},success:function(data){loadingRemove(),data.success?window.location.href="../ucenter/bank_success.html":alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?alert("提交失败，请重试"):"timeout"==status&&alert("提交失败，请重试")}}):$.ajax({url:api+"/api/wx/account/password/edit",type:"POST",dataType:"json",data:{password:password,account:account(),requestTokenId:requestTokenId()},success:function(data){loadingRemove(),data.success?window.location.href="../ucenter/psw_success.html":alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?alert("提交失败，请重试"):"timeout"==status&&alert("提交失败，请重试")}})}function pswPayShow(){$(".psw_pay_w").show(),$(".ipt-real-nick").focus()}function fillInPaySubmit(){var password=$('[name="password"]').val();if(password){if(0==password.length)return $(".msg").html('<span class="red">请输入安全密码</span>'),!1;if(!isPswPay(password))return $(".msg").html('<span class="red">请输入6位纯数字安全密码</span>'),!1;loading("验证中..."),$.ajax({url:api+"/api/wx/account/findaccountbypassword",type:"POST",timeout:1e4,dataType:"json",data:{account:account(),password:password,requestTokenId:requestTokenId()},success:function(data){loadingRemove(),data.success?null!=data.info?window.location.href="../ucenter/bank_psw.html?edit=1":$(".msg").html('<span class="red">安全密码输入错误</span>'):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?alert("提交失败，请重试"):"timeout"==status&&alert("提交失败，请重试")}})}else $(".msg").html('<span class="red">请输入安全密码</span>')}function resetPswSubmit(){if(!PhoneNo($('[name="tel"]')))return PhoneNo($('[name="tel"]')),!1;if(!verify($('[name="code"]')))return verify($('[name="code"]')),!1;if(!password($('[name="password"]')))return password($('[name="password"]')),!1;if(!password2($('[name="password2"]')))return password2($('[name="password2"]')),!1;var data={phone:$('[name="tel"]').val(),code:$('[name="code"]').val(),newPwd:$("[name=password]").val(),requestTokenId:requestTokenId()};$.ajax({url:api+"/api/wx/login/pwforget",type:"POST",dataType:"json",data:data,success:function(data){data.success?(alert("重置成功"),window.location.href="../ucenter/ucenter.html"):alert(data.message)}})}function resetSubmit(){if(!verify($('[name="code"]')))return verify($('[name="code"]')),!1;if(!password($('[name="password"]')))return password($('[name="password"]')),!1;if(!password2($('[name="password2"]')))return password2($('[name="password2"]')),!1;loading("保存中...");var login_code=$('[name="code"]').val(),login_psw=$("[name=password]").val(),data={phone:userName(),code:login_code,newPwd:login_psw,requestTokenId:requestTokenId()};$.ajax({url:api+"/api/wx/login/pwforget",type:"POST",dataType:"json",data:data,success:function(data){loadingRemove(),data.success?$.MsgBox.AlertL("重置成功","确定",function(){window.location.href="../ucenter/ucenter.html"}):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("重置密码失败，请重试"):"timeout"==status&&fubottom("重置密码失败，请重试")}})}function foPswSubmit(){if(!PhoneNo($('[name="tel"]')))return PhoneNo($('[name="tel"]')),!1;if(!verify($('[name="code"]')))return verify($('[name="code"]')),!1;if(!password($('[name="password"]')))return password($('[name="password"]')),!1;if(!password2($('[name="password2"]')))return password2($('[name="password2"]')),!1;loading("提交中...");var data={phone:$('[name="tel"]').val(),code:$('[name="code"]').val(),newPwd:$("[name=password]").val(),requestTokenId:requestTokenId()};$.ajax({url:api+"/api/wx/login/pwforget",type:"POST",dataType:"json",data:data,success:function(data){loadingRemove(),data.success?(alert("重置成功"),history.back(-1)):alert(data.message)}})}function resetCode(e){userName()?(loading("提交中..."),$.ajax({url:api+"/api/wx/validation/getcode",type:"POST",dataType:"json",data:{phone:userName(),type:1,requestTokenId:requestTokenId()},success:function(data){loadingRemove(),data.success?(e.removeAttr("onclick").html('<span id="dao_time">60</span>秒再次获取'),countDown3("#dao_time",60)):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("获取验证码失败，请重试"):"timeout"==status&&fubottom("获取验证码失败，请重试")}})):alert("您还没有登录，请返回重新登录！")}function resetCodeZ(e){userName()?(loading("获取中..."),$.ajax({url:api+"/api/wx/validation/getcode",type:"POST",dataType:"json",data:{phone:userName(),type:3,requestTokenId:requestTokenId()},success:function(data){loadingRemove(),data.success?(e.removeAttr("onclick").html('<span id="dao_time">60</span>秒再次获取'),countDown4("#dao_time",60)):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("获取验证码失败，请重试"):"timeout"==status&&fubottom("获取验证码失败，请重试")}})):alert("您还没有登录，请返回重新登录！")}function resetCodeB(e){userName()&&(loading("获取中..."),$.ajax({url:api+"/api/wx/validation/getcode",type:"POST",dataType:"json",data:{phone:userName(),type:2,requestTokenId:requestTokenId()},success:function(data){loadingRemove(),data.success?(e.removeAttr("onclick").html('<span id="dao_time">60</span>秒再次获取'),countDown5("#dao_time",60)):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("获取验证码失败，请重试"):"timeout"==status&&fubottom("获取验证码失败，请重试")}}))}function resetGetCode(e){if(PhoneNo($('[name="tel"]'))){loading("获取中...");var lonin_tel=$('[name="tel"]').val();$.ajax({url:api+"/api/wx/validation/getcode",type:"POST",dataType:"json",data:{phone:lonin_tel,type:1,requestTokenId:requestTokenId()},success:function(data){loadingRemove(),data.success?(e.removeAttr("onclick").html('<span id="dao_time">60</span>秒再次获取'),countDown2("#dao_time",60)):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("获取验证码失败，请重试"):"timeout"==status&&fubottom("获取验证码失败，请重试")}})}}function countDown2(e,num){num=num;var timer=setInterval(function(){num--,$(e).html(num),0==num&&($(".reset_password li a").attr("onclick","resetGetCode($(this))").html("获取验证码"),clearInterval(timer))},1e3)}function countDown3(e,num){num=num;var timer=setInterval(function(){num--,$(e).html(num),0==num&&($(".reset_password li a").attr("onclick","resetCode($(this))").html("获取验证码"),clearInterval(timer))},1e3)}function countDown4(e,num){num=num;var timer=setInterval(function(){num--,$(e).html(num),0==num&&($(".tel_code a").attr("onclick","resetCodeZ($(this))").html("获取验证码"),clearInterval(timer))},1e3)}function countDown5(e,num){num=num;var timer=setInterval(function(){num--,$(e).html(num),0==num&&($(".tel_code a").attr("onclick","resetCodeB($(this))").html("获取验证码"),clearInterval(timer))},1e3)}function accountDetailSearch(){for(var accountTypeD=$('[name="type"]'),TypeArr=[],i=0;i<accountTypeD.length;i++)accountTypeD.eq(i).attr("checked")&&TypeArr.push(accountTypeD.eq(i).val());var accountType=TypeArr.toString(),searchTimeV=$('[name="time"]').val();if(searchTimeV)var searchTimeArr=searchTimeV.split("-"),searchTimeCuo=new Date(searchTimeArr[0],searchTimeArr[1]-1,1).getTime();else searchTimeCuo="";window.location.href=accountType||searchTimeCuo?window.location.pathname+"?accountType="+accountType+"&searchTimeCuo="+searchTimeCuo:window.location.pathname}