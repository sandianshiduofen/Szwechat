"use strict";function selfLoading(){if(GetQueryString("waybill")){$('[name="senderId"]').val(number()),$('[name="senderRegisterMobile"]').val(userName()),loading("loading..."),document.title="修改运单",$("#selfSubmit").attr("onclick","auto_help_edit()");var waybill=GetQueryString("waybill");$.ajax({url:apiAn+"/api/wx/waybill/getWaybill",type:"POST",timeout:1e4,dataType:"json",data:{waybillNo:waybill,requestTokenId:requestTokenId()},success:function(data){if(loadingRemove(),data.success){var info=data.info;if(console.log(info),$("#selfSubmit").attr("onclick","auto_help_edit()"),$('[name="receiverName"]').val(info.receiverName),$('[name="receiverLinkman"]').val(info.receiverLinkman),$('[name="receiverMobile"]').val(info.receiverMobile),$('[name="receiverProvinceName"]').val(info.receiverProvinceName),$('[name="receiverCityName"]').val(info.receiverCityName),$('[name="receiverAreaName"]').val(info.receiverAreaName),$('[name="receiverProvinceId"]').val(info.receiverProvinceId),$('[name="receiverCityId"]').val(info.receiverCityId),$('[name="receiverAreaId"]').val(info.receiverAreaId),$('[name="receiverAddress"]').val(info.receiverAddress),$('[name="receiverId"]').val(info.receiverId),$('[name="receiverRegisterCompany"]').val(info.receiverName),info.receiverLinkman)var receiverLinkman=info.receiverLinkman;else receiverLinkman="";var receiverhtml='<p id="addr_receiver"> '+info.receiverName+" <br> "+receiverLinkman+" "+info.receiverMobile+"  <br>"+info.receiverProvinceName+" "+info.receiverCityName+" "+info.receiverAreaName+" "+info.receiverAddress+"</p>";if($(".delivery_edit a").html(receiverhtml),$('[name="senderName"]').val(info.senderName),$('[name="senderLinkman"]').val(info.senderLinkman),$('[name="senderMobile"]').val(info.senderMobile),$('[name="senderProvinceName"]').val(info.senderProvinceName),$('[name="senderCityName"]').val(info.senderCityName),$('[name="senderAreaName"]').val(info.senderAreaName),$('[name="senderProvinceId"]').val(info.senderProvinceId),$('[name="senderCityId"]').val(info.senderCityId),$('[name="senderAreaId"]').val(info.senderAreaId),$('[name="senderAddress"]').val(info.senderAddress),info.senderLinkman)var senderLinkman=info.senderLinkman;else senderLinkman="";var senderhtml='<p id="addr_consigner"> '+info.senderName+" <br> "+senderLinkman+" "+info.senderMobile+"  <br>"+info.senderProvinceName+" "+info.senderCityName+" "+info.senderAreaName+" "+info.senderAddress+"</p>";if($(".consigner_edit a").html(senderhtml),$('[name="goodsName"]').val(info.goodsName),$('[name="goodsQuantity"]').val(info.goodsQuantity),1<info.goodsQuantity&&$("#reduce").removeClass("no"),999<=info.goodsQuantity&&$("#increase").addClass("no"),info.goodsAmount){$('[name="collection"]').attr("checked","checked");var ADian=outputmoney(parseFloat(info.goodsAmount).toFixed(2));$('[name="goodsAmount"]').val(info.goodsAmount),$('[name="have_coll"]').val(ADian).attr("onclick","price_open()")}$('[name="payType"]').eq(info.payType-1).attr("checked","checked"),1<=data.info.status?(bannceEdit(info.senderCityId,info.senderAreaId,info.receiverAreaId,info.inputDotId,data.info.status),$(".consigner_edit a").removeAttr("onclick").parents("tr").css("background","#f5f5f5"),$(".delivery_edit a").removeAttr("onclick").parents("tr").css("background","#f5f5f5"),$(".addr_book_btn").remove(),$('[name="goodsName"]').addClass("lost").attr("readonly","readonly"),$('[name="goodsQuantity"]').attr("readonly","readonly").css({background:"#f1f1f1",borderColor:"#ccc",color:"#999"}),$(".have_coll_a").css("background","#fff"),$("span#reduce").removeAttr("onclick").css("background-image","url(../skin/images/jian2.png)"),$("span#increase").removeAttr("onclick").css("background-image","url(../skin/images/jia2.png)"),$('[name="payType"]').attr("disabled","disabled"),$("#selfSubmit").attr("onclick","auto_help_coll()"),$(".payment:checked+span").css("border-color","#999"),$(".payment:checked+span b").css("background","#999")):bannceEdit(info.senderCityId,info.senderAreaId,info.receiverAreaId,info.inputDotId)}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?($("a").removeAttr("onclick"),alert("请求超时，请刷新重新获取")):"timeout"==status&&($("a").removeAttr("onclick"),alert("请求超时，请刷新重新获取"))}})}else userId()&&self_load()}function selfHeaderGoback(){history.back(-1)}function addno(){var val=parseInt($(".parcel_num").val());if(val<=1)$("#reduce").addClass("no");else{if(!(100<=val))return!0;$("#increase").addClass("no")}}function self_load(){if(userId()){if(loading("加载中..."),$.ajax({url:api+"/api/wx/login/finduser",type:"POST",dataType:"json",timeout:1e4,data:{id:userId(),requestTokenId:requestTokenId()},success:function(data){data.success?data.info.company?$.ajax({url:apiL+"/api/wx/address/find",type:"post",timeout:1e4,dataType:"json",data:{type:1,userId:userId(),requestTokenId:requestTokenId()},success:function(data){if(data.success){for(var html="",i=0;i<data.info.length;i++)if(1==data.info[i].isDefault){if(data.info[i].contact)var contact=data.info[i].contact;else contact="";html='<p id="addr_consigner"> '+data.info[i].company+" <br> "+contact+" "+data.info[i].phone+"  <br>"+data.info[i].proName+" "+data.info[i].cityName+" "+data.info[i].areaName+" "+data.info[i].detailed+"</p>",$(".consigner_edit a").html(html),$('[name="senderAddId"]').val(data.info[i].id),$('[name="senderAddIsDf"]').val(data.info[i].isDefault),$('[name="senderName"]').val(data.info[i].company),$('[name="senderLinkman"]').val(data.info[i].contact),$('[name="senderMobile"]').val(data.info[i].phone),$('[name="senderProvinceName"]').val(data.info[i].proName),$('[name="senderCityName"]').val(data.info[i].cityName),$('[name="senderAreaName"]').val(data.info[i].areaName),$('[name="senderProvinceId"]').val(data.info[i].proNumber),$('[name="senderCityId"]').val(data.info[i].cityNumber),$('[name="senderAreaId"]').val(data.info[i].areaNumber),$('[name="senderAddress"]').val(data.info[i].detailed)}}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status&&$.MsgBox.Confirmt("默认发货地址获取失败，重新获取？","重新获取","我自己选",function(){return!1},function(){self_load()})}}):window.location.href="/login/login_addr.html?unionid="+data.info.unionid:alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?document.write("请求失败,请返回公众号重新进入"):"timeout"==status&&document.write("请求失败,请返回公众号重新进入")}}),$('[name="senderId"]').val(number()),$('[name="senderRegisterMobile"]').val(userName()),$('[name="senderName"]').val()){var sendCompany=$('[name="senderName"]').val(),sendContact=$('[name="senderLinkman"]').val(),sendPhone=$('[name="senderMobile"]').val(),sendProName=$('[name="senderProvinceName"]').val(),sendCityName=$('[name="senderCityName"]').val(),sendAreaName=$('[name="senderAreaName"]').val(),html=($('[name="senderProvinceId"]').val(),$('[name="senderCityId"]').val(),$('[name="senderAreaId"]').val(),'<p id="addr_consigner"> '+sendCompany+" <br> "+sendContact+" "+sendPhone+"  <br>"+sendProName+" "+sendCityName+" "+sendAreaName+" "+$('[name="senderAddress"]').val()+"</p>");$(".consigner_edit a").html(html)}if($('[name="receiverName"]').val()){var receCompany=$('[name="receiverName"]').val(),receContact=$('[name="receiverLinkman"]').val(),recePhone=$('[name="receiverMobile"]').val(),receProName=$('[name="receiverProvinceName"]').val(),receCityName=$('[name="receiverCityName"]').val(),receAreaName=$('[name="receiverAreaName"]').val();$('[name="receiverProvinceId"]').val(),$('[name="receiverCityId"]').val(),$('[name="receiverAreaId"]').val(),html='<p id="addr_receiver"> '+receCompany+" <br> "+receContact+" "+recePhone+"  <br>"+receProName+" "+receCityName+" "+receAreaName+" "+$('[name="receiverAddress"]').val()+"</p>";$(".delivery_edit a").html(html)}}}function consigner(){$('[name="consigner"]').val()?GetQueryString("waybill")?window.location.href="../ucenter/consigner_edit.html?edit=1&from=selfH&waybill=selfH&order="+GetQueryString("waybill"):window.location.href="../ucenter/consigner_edit.html?edit=1&from=selfH&order="+GetQueryString("waybill"):window.location.href="../ucenter/consigner_edit.html?add=selfH"}function delivery(){if($('[name="delivery"]').val()){$('[name="delivery"]').val();GetQueryString("waybill")?window.location.href="../ucenter/receiving_edit.html?edit=1&from=selfH&waybill=selfH&order="+GetQueryString("waybill"):window.location.href="../ucenter/receiving_edit.html?edit=1&from=selfH&order="+GetQueryString("waybill")}else window.location.href="../ucenter/receiving_edit.html?add=selfH"}function price_open(){if(0<$('[name="goodsAmount"]').val())var haveColl=$('[name="goodsAmount"]').val();else haveColl="";$("body").append('<div class="receive_pop_w agency_fund"><div class="receive_pop"><div class="receive_pop_c"><div class="receive_pop_close" onclick="receive_close()"></div><div class="uc_cou_bot"><div class="receive_pop_tit"><span onclick="receive_close()"></span></div><div class="uc_cou_con collection_pop"><input class="price_coll" type="number" placeholder="输入代收货款金额" onblur="coll_price($(this))" oninput="if(value.length>9)value=value.slice(0,9);"><p class="msg"></p><p>请认真核对代收款金额，运单未签收前您可自助修改金额</p><footer><a class="footer_btn" href="javascript:;" onclick="coll_submit()">确定</a></footer></div></div></div></div></div>');var priceA=parseFloat(haveColl).toFixed(2);$(".price_coll").val(priceA).focus()}function receive_close(){$(".agency_fund").remove(),parseFloat($('[name="goodsAmount"]').val())<5&&($('[name="collection"]').removeAttr("checked"),$('[name="have_coll"]').removeAttr("onclick"))}function coll_submit(){if(coll_price($(".price_coll"))){var val=$(".price_coll").val(),price=parseFloat(val).toFixed(2),dian=outputmoney(price);$("#have_coll").val(dian),$('[name="goodsAmount"]').val(price),$(".agency_fund").remove()}else coll_price($(".price_coll"))}function outputmoney(number){return number=number.replace(/\,/g,""),isNaN(number)||""==number?"":(number=Math.round(100*number)/100)<0?"-"+outputdollars(Math.floor(Math.abs(number)-0)+"")+outputcents(Math.abs(number)-0):outputdollars(Math.floor(number-0)+"")+outputcents(number-0)}function outputdollars(number){if(number.length<=3)return""==number?"0":number;for(var mod=number.length%3,output=0==mod?"":number.substring(0,mod),i=0;i<Math.floor(number.length/3);i++)output+=0==mod&&0==i?number.substring(mod+3*i,mod+3*i+3):","+number.substring(mod+3*i,mod+3*i+3);return output}function outputcents(amount){return(amount=Math.round(100*(amount-Math.floor(amount))))<10?".0"+amount:"."+amount}function coll_price(e){var price_val=e.val();return price_val?isverify(price_val)?parseFloat(price_val)<2?($(".msg").html('<span class="red">代收货款金额最低为2元</span>'),!1):($(".msg").html(""),!0):($(".msg").html('<span class="red">小数点后最多保留两位小数,代收货款需低于100万</span>'),!1):($(".msg").html('<span class="red">请输入正确的代收货款金额</span>'),!1)}function isverify(verify){return/^\d{1,6}(\.\d{1,2})?$/.test(verify)}function num_change(e){if(e.val()<=1)return e.val("1"),$("#reduce").addClass("no"),$("#increase").removeClass("no"),!1;if(999<=e.val())return e.val("999"),$("#reduce").removeClass("no"),$("#increase").addClass("no"),!1;if($("#reduce").removeClass("no"),$("#increase").removeClass("no"),!/^\d+$/.test(e.val())){var intval=parseInt(e.val());isNaN(intval)?(e.val(1),$("#reduce").addClass("no"),$("#increase").removeClass("no")):(e.val(intval),1==intval&&($("#reduce").addClass("no"),$("#increase").removeClass("no")))}self_btn_show()}function reduce(e){var val=parseInt(e.siblings(".parcel_num").val());val<=1?e.addClass("no"):(1==--val&&e.addClass("no"),$("#increase").removeClass("no")),e.siblings(".parcel_num").val(val)}function increase(e){var val=parseInt(e.siblings(".parcel_num").val());999<=val?e.addClass("no"):(999==++val&&e.addClass("no"),$("#reduce").removeClass("no")),e.siblings(".parcel_num").val(val)}function self_submit(){var consigner=$('input[name="senderName"]').val(),delivery=$('input[name="receiverName"]').val(),goodsName=$('input[name="goodsName"]').val(),branch=$('input[name="inputDotId"]:checked').val(),have_coll=($('input[name="payType"]:checked').val(),"1");$(".pay_way2").attr("checked")&&(have_coll=$(".have_coll").val()),consigner?delivery?goodsName?have_coll?branch?protocol():$.MsgBox.Alert("请选择发货网点","确定"):$.MsgBox.Alert("请输入代收货款金额","确定"):$.MsgBox.Alert("请填写货物信息","确定"):$.MsgBox.Alert("请填写收货人的联系方式和详细信息","确定"):$.MsgBox.Alert("请填写发货人的联系方式和详细信息","确定")}function self_btn_show(){var consigner=$('input[name="senderName"]').val(),delivery=$('input[name="receiverName"]').val(),goodsName=trim($('input[name="goodsName"]').val()),branch=$('input[name="inputDotId"]:checked').val(),goodsQuantity=$('input[name="goodsQuantity"]').val();consigner&&delivery&&goodsName&&branch&&goodsQuantity?$(".footer_self .footer_btn").removeClass("hui").removeAttr("disabled"):$(".footer_self .footer_btn").addClass("hui").attr("disabled","disabled")}function protocol(){$(".protocol_w").css("display","block")}function protocol_close(){$(".protocol_w").css("display","none")}function auto_help_ok(){loading("提交中..."),$.ajax({url:apiAn+"/api/wx/waybill/insertWaybill",type:"POST",timeout:1e4,dataType:"json",data:$("#selfHelpOrder").serialize(),success:function(data){if(loadingRemove(),data.success){$("#selfSubmit").attr("disabled","disabled");var timer=setTimeout(function(){clearTimeout(timer),$("#selfSubmit").removeAttr("disabled")},5e3),order=data.info;window.location.href="../order/order_succeed.html?order="+order}else alert(data.message)},complete:function(XMLHttpRequest,status){$('[name="requestTokenId"]').val(requestTokenId()),loadingRemove(),"error"==status?alert("提交失败，请重试"):"timeout"==status&&alert("提交失败，请重试")}})}function auto_help_edit(){loading("提交中...");var waybillNo=GetQueryString("waybill");$.ajax({url:apiAn+"/api/wx/waybill/editWaybill",type:"POST",timeout:1e4,dataType:"json",data:$("#selfHelpOrder").serialize()+"&no="+waybillNo,success:function(data){if(loadingRemove(),data.success){$("#selfSubmit").attr("disabled","disabled").css("background","#999");var timer=setTimeout(function(){clearTimeout(timer),$("#selfSubmit").removeAttr("disabled").css("background","#52BB03")},5e3),order=data.info;window.location.href="../order/scan.html?order="+order}else alert(data.message)},complete:function(XMLHttpRequest,status){$('[name="requestTokenId"]').val(requestTokenId()),loadingRemove(),"error"==status?fubottom("修改失败，请重试"):"timeout"==status&&fubottom("修改失败，请重试")}})}function auto_help_coll(){loading("提交中...");var goodsAmount=$('[name="goodsAmount"]').val(),waybillNo=GetQueryString("waybill"),data={no:waybillNo,waybillNo:waybillNo,goodsAmount:goodsAmount,requestTokenId:requestTokenId()};$.ajax({url:apiAn+"/api/wx/waybill/editWaybillGoodsAmount",type:"POST",timeout:1e4,dataType:"json",data:data,success:function(data){if(loadingRemove(),data.success){$("#selfSubmit").attr("disabled","disabled").css("background","#999");var timer=setTimeout(function(){clearTimeout(timer),$("#selfSubmit").removeAttr("disabled").css("background","#52BB03")},5e3),order=data.info;window.location.href="../order/scan.html?order="+order}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("修改失败，请重试"):"timeout"==status&&fubottom("修改失败，请重试")}})}function bannce(cityId,areaId,receiverAreaId){if(areaId)return $.ajax({url:apiAn+"/api/wx/dot/getListByArea",type:"POST",timeout:1e4,dataType:"json",data:{cityId:cityId,areaId:areaId,receiverAreaId:receiverAreaId,requestTokenId:requestTokenId()},success:function(data){if(data.success)if(0<data.info.length){var html='<h6>附近可揽货网点：共为您匹配到<span class="red">'+data.info.length+"</span>家可揽货网点</h6>";html+="<ul>";new Date;for(var i=0;i<data.info.length;i++){var startBusinessHour=data.info[i].startBusinessHour.slice(0,5),endBusinessHour=data.info[i].endBusinessHour.slice(0,5);data.info[i].inBusiness?html+='<li data-id="'+data.info[i].id+'">':html+='<li class="branch_close" data-id="'+data.info[i].id+'">',html+='<label><div class="branch_w"><div class="branch_l"><p><input class="pay_way branch" id="branch'+data.info[i].id+'" type="radio" name="inputDotId"  value="'+data.info[i].id+'"><span><b></b></span>'+data.info[i].name+'</p><p>&nbsp;</p></div><div class="branch_r"><span>揽货时间：<br>'+startBusinessHour+"--"+endBusinessHour+"</span></div></div><p>营业地址："+data.info[i].province+data.info[i].city+data.info[i].area+data.info[i].address+'</p></label><a href="tel:'+data.info[i].tel1+'" class="blue DotTel">'+data.info[i].tel1+"</a></li>"}html+="</ul>",$(".nearby").html(html)}else{html='<h6>附近可揽货网点：共为您匹配到<span class="red">'+data.info.length+"</span>家可揽货网点</h6>";$(".nearby").html(html),$.MsgBox.Alert(data.message,"确定")}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".nearby"),200,"获取网点失败，请点击重新获取","bannce("+cityId+","+areaId+","+receiverAreaId+")"):"timeout"==status&&noResultErr($(".nearby"),200,"获取网点失败，请点击重新获取","bannce("+cityId+","+areaId+","+receiverAreaId+")")}}),!0}function bannceEdit(cityId,areaId,receiverAreaId,id,status){var statu=status;areaId&&$.ajax({url:apiAn+"/api/wx/dot/getListByArea",type:"POST",timeout:1e4,dataType:"json",data:{cityId:cityId,areaId:areaId,receiverAreaId:receiverAreaId,requestTokenId:requestTokenId()},success:function(data){if(data.success){if(status){html='<h6>附近可揽货网点：共为您匹配到<span class="red">1</span>家可揽货网点</h6>';html+="<ul>";new Date;$.ajax({url:apiAn+"/api/wx/dot/getDotById",type:"post",timeout:1e4,dataType:"json",async:!1,data:{dotId:id,requestTokenId:requestTokenId()},success:function(data){if(data.success){var info=data.info,startBusinessHour=info.startBusinessHour.slice(0,5),endBusinessHour=info.endBusinessHour.slice(0,5);info.inBusiness?html+='<li data-id="'+info.id+'">':html+='<li class="branch_close" data-id="'+info.id+'">',html+='<label><div class="branch_w"><div class="branch_l">',html+='<p><input class="pay_way branch" id="branch'+info.id+'" type="radio" name="inputDotId"  value="'+info.id+'" disabled="disabled"><span><b></b></span>'+info.name+"</p>",html+='<p>&nbsp;</p></div><div class="branch_r"><span>揽货时间：<br>'+startBusinessHour+"--"+endBusinessHour+"</span></div></div><p>营业地址："+info.province+info.city+info.area+info.address+'</p></label><a href="tel:'+data.info[i].tel1+'" class="blue DotTel">'+data.info[i].tel1+"</a></li>"}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".nearby"),200,"获取网点失败，请点击重新获取","bannceEdit("+cityId+","+areaId+","+receiverAreaId+","+id+","+statu+")"):"timeout"==status&&noResultErr($(".nearby"),200,"获取网点失败，请点击重新获取","bannceEdit("+cityId+","+areaId+","+receiverAreaId+","+id+","+statu+")")}})}else{var html='<h6>附近可揽货网点：共为您匹配到<span class="red">'+data.info.length+"</span>家可揽货网点</h6>";html+="<ul>";new Date;for(var i=0;i<data.info.length;i++){var startBusinessHour=data.info[i].startBusinessHour.slice(0,5),endBusinessHour=data.info[i].endBusinessHour.slice(0,5);data.info[i].inBusiness?html+='<li data-id="'+data.info[i].id+'">':html+='<li class="branch_close" data-id="'+data.info[i].id+'">',html+='<label><div class="branch_w"><div class="branch_l">',html+='<p><input class="pay_way branch" id="branch'+data.info[i].id+'" type="radio" name="inputDotId"  value="'+data.info[i].id+'"><span><b></b></span>'+data.info[i].name+"</p>",html+='<p>&nbsp;</p></div><div class="branch_r"><span>揽货时间：<br>'+startBusinessHour+"--"+endBusinessHour+"</span></div></div><p>营业地址："+data.info[i].province+data.info[i].city+data.info[i].area+data.info[i].address+'</p></label><a href="tel:'+data.info[i].tel1+'" class="blue DotTel">'+data.info[i].tel1+"</a></li>"}}html+="</ul>",$(".nearby").html(html),$("#branch"+id).attr("checked","checked"),status&&($(".branch:checked+span").css("border-color","#999"),$(".branch:checked+span b").css("background","#999")),self_btn_show()}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".nearby"),200,"获取网点失败，请点击重新获取","bannceEdit("+cityId+","+areaId+","+receiverAreaId+","+id+","+statu+")"):"timeout"==status&&noResultErr($(".nearby"),200,"获取网点失败，请点击重新获取","bannceEdit("+cityId+","+areaId+","+receiverAreaId+","+id+","+statu+")")}})}function bannceEdit(cityId,areaId,receiverAreaId,id,status){var statu=status;areaId&&(status?$.ajax({url:apiAn+"/api/wx/dot/getDotById",type:"post",timeout:1e4,dataType:"json",async:!1,data:{dotId:id,requestTokenId:requestTokenId()},success:function(data){if(data.success){var html='<h6>附近可揽货网点：共为您匹配到<span class="red">1</span>家可揽货网点</h6>';html+="<ul>";new Date;var info=data.info,startBusinessHour=info.startBusinessHour.slice(0,5),endBusinessHour=info.endBusinessHour.slice(0,5);info.inBusiness?html+='<li data-id="'+info.id+'">':html+='<li class="branch_close" data-id="'+info.id+'">',html+='<label><div class="branch_w"><div class="branch_l">',html+='<p><input class="pay_way branch" id="branch'+info.id+'" type="radio" name="inputDotId"  value="'+info.id+'" disabled="disabled"><span><b></b></span>'+info.name+"</p>",html+='<p><a href="tel:'+info.tel1+'" class="blue">'+info.tel1+'</a></p></div><div class="branch_r"><span>揽货时间：<br>'+startBusinessHour+"--"+endBusinessHour+"</span></div></div><p>营业地址："+info.province+info.city+info.area+info.address+"</p></label></li>",html+="</ul>",$(".nearby").html(html),$("#branch"+id).attr("checked","checked"),status&&($(".branch:checked+span").css("border-color","#999"),$(".branch:checked+span b").css("background","#999")),self_btn_show()}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".nearby"),200,"获取网点失败，请点击重新获取","bannceEdit("+cityId+","+areaId+","+receiverAreaId+","+id+","+statu+")"):"timeout"==status&&noResultErr($(".nearby"),200,"获取网点失败，请点击重新获取","bannceEdit("+cityId+","+areaId+","+receiverAreaId+","+id+","+statu+")")}}):$.ajax({url:apiAn+"/api/wx/dot/getListByArea",type:"POST",timeout:1e4,dataType:"json",data:{cityId:cityId,areaId:areaId,receiverAreaId:receiverAreaId,requestTokenId:requestTokenId()},success:function(data){if(data.success){var html='<h6>附近可揽货网点：共为您匹配到<span class="red">'+data.info.length+"</span>家可揽货网点</h6>";html+="<ul>";new Date;for(var i=0;i<data.info.length;i++){var startBusinessHour=data.info[i].startBusinessHour.slice(0,5),endBusinessHour=data.info[i].endBusinessHour.slice(0,5);data.info[i].inBusiness?html+='<li data-id="'+data.info[i].id+'">':html+='<li class="branch_close" data-id="'+data.info[i].id+'">',html+='<label><div class="branch_w"><div class="branch_l">',html+='<p><input class="pay_way branch" id="branch'+data.info[i].id+'" type="radio" name="inputDotId"  value="'+data.info[i].id+'"><span><b></b></span>'+data.info[i].name+"</p>",html+='<p>&nbsp;</p></div><div class="branch_r"><span>揽货时间：<br>'+startBusinessHour+"--"+endBusinessHour+"</span></div></div><p>营业地址："+data.info[i].province+data.info[i].city+data.info[i].area+data.info[i].address+'</p></label><a href="tel:'+data.info[i].tel1+'" class="blue DotTel">'+data.info[i].tel1+"</a></li>"}html+="</ul>",$(".nearby").html(html),$("#branch"+id).attr("checked","checked"),status&&($(".branch:checked+span").css("border-color","#999"),$(".branch:checked+span b").css("background","#999")),self_btn_show()}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".nearby"),200,"获取网点失败，请点击重新获取","bannceEdit("+cityId+","+areaId+","+receiverAreaId+","+id+","+statu+")"):"timeout"==status&&noResultErr($(".nearby"),200,"获取网点失败，请点击重新获取","bannceEdit("+cityId+","+areaId+","+receiverAreaId+","+id+","+statu+")")}}))}function consignerBook(){GetQueryString("waybill")?window.location.href="../ucenter/ship_address.html?selfHp="+GetQueryString("waybill")+"&waybill=1":window.location.href="../ucenter/ship_address.html?selfHp="+GetQueryString("waybill")}function deliveryBook(){GetQueryString("waybill")?window.location.href="../ucenter/receiving_party.html?selfHp="+GetQueryString("waybill")+"&waybill=addr":window.location.href="../ucenter/receiving_party.html?selfHp="+GetQueryString("waybill")}function selfFaEdit(e){e.parents(".self_help_w").remove()}function selfShouEdit(e){e.parents(".self_help_w").remove()}function selfShipSubmit(){if(!noNullfa($('[name="client"]'),"单位名称"))return noNullfa($('[name="client"]'),"单位名称"),!1;if(!telNo($('[name="tel"]')))return telNo($('[name="tel"]')),!1;if(!noNull($('[name="aeraNum"]'),"所在省、市、区"))return noNull($('[name="aeraNum"]'),"所在省、市、区"),!1;if(!noNullfa($('[name="detail"]'),"详细地址"))return noNullfa($('[name="detail"]'),"详细地址"),!1;loading("提交中...");var senderAddId=$('[name="senderAddId"]').val(),senderAddIsDf=$('[name="senderAddIsDf"]').val(),company=trim($('[name="client"]').val()),contact=trim($('[name="name"]').val()),phone=trim($('[name="tel"]').val()),aera=$("#addr_aera").html(),aeraNum=$('[name="aeraNum"]').val(),detailed=trim($('[name="detail"]').val()),aeraArr=aera.split(" "),aeraNumArr=aeraNum.split(",");if(1==senderAddIsDf)var isDefault=1;else isDefault=0;Recdistinctive()&&(senderAddId?AMap.service("AMap.Geocoder",function(){loadingRemove(),new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2]+detailed,function(status,result){if("complete"===status&&"OK1"===result.info){loading("提交中...");var data={userId:userId(),type:1,id:senderAddId,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],detailed:detailed,lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,isDefault:isDefault,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/edit",type:"get",timeout:1e4,dataType:"json",data:data,success:function(data){if(loadingRemove(),data.success){$('[name="senderName"]').val(company),$('[name="senderLinkman"]').val(contact),$('[name="senderMobile"]').val(phone),$('[name="senderProvinceName"]').val(aeraArr[0]),$('[name="senderCityName"]').val(aeraArr[1]),$('[name="senderAreaName"]').val(aeraArr[2]),$('[name="senderProvinceId"]').val(aeraNumArr[0]),$('[name="senderCityId"]').val(aeraNumArr[1]),$('[name="senderAreaId"]').val(aeraNumArr[2]),$('[name="senderAddress"]').val(detailed);var html='<p id="addr_consigner"> '+company+" <br> "+contact+" "+phone+"  <br>"+aeraArr[0]+" "+aeraArr[1]+" "+aeraArr[2]+" "+detailed+"</p>";$(".consigner_edit a").html(html),$(".self_fa_edit").remove();var receiverAreaId=$('[name="receiverAreaId"]').val();receiverAreaId&&bannce(aeraNumArr[1],aeraNumArr[2],receiverAreaId)&&setTimeout(function(){self_btn_show()},100)}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?($(".selfShipSubmit").removeAttr("disabled"),fubottom("提交失败，请重试")):"timeout"==status&&($(".selfShipSubmit").removeAttr("disabled"),fubottom("提交失败，请重试"))}})}else AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2],function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("提交中...");var data={userId:userId(),type:1,id:senderAddId,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],detailed:detailed,lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,isDefault:isDefault,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/edit",type:"get",timeout:1e4,dataType:"json",data:data,success:function(data){if(loadingRemove(),data.success){$('[name="senderName"]').val(company),$('[name="senderLinkman"]').val(contact),$('[name="senderMobile"]').val(phone),$('[name="senderProvinceName"]').val(aeraArr[0]),$('[name="senderCityName"]').val(aeraArr[1]),$('[name="senderAreaName"]').val(aeraArr[2]),$('[name="senderProvinceId"]').val(aeraNumArr[0]),$('[name="senderCityId"]').val(aeraNumArr[1]),$('[name="senderAreaId"]').val(aeraNumArr[2]),$('[name="senderAddress"]').val(detailed);var html='<p id="addr_consigner"> '+company+" <br> "+contact+" "+phone+"  <br>"+aeraArr[0]+" "+aeraArr[1]+" "+aeraArr[2]+" "+detailed+"</p>";$(".consigner_edit a").html(html),$(".self_fa_edit").remove();var receiverAreaId=$('[name="receiverAreaId"]').val();receiverAreaId&&bannce(aeraNumArr[1],aeraNumArr[2],receiverAreaId)&&setTimeout(function(){self_btn_show()},100)}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?($(".selfShipSubmit").removeAttr("disabled"),fubottom("提交失败，请重试")):"timeout"==status&&($(".selfShipSubmit").removeAttr("disabled"),fubottom("提交失败，请重试"))}})}else $.MsgBox.Alert("地址获取失败，请重试或修改地址后再试","确定")})})})}):AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2]+detailed,function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("提交中...");var data={userId:userId(),type:1,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],detailed:detailed,lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,isDefault:isDefault,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/add",type:"get",timeout:1e4,dataType:"json",data:data,success:function(data){if(loadingRemove(),data.success){$('[name="senderAddId"]').val(data.info.id),$('[name="senderAddIsDf"]').val(data.info.isDefault),$('[name="senderName"]').val(company),$('[name="senderLinkman"]').val(contact),$('[name="senderMobile"]').val(phone),$('[name="senderProvinceName"]').val(aeraArr[0]),$('[name="senderCityName"]').val(aeraArr[1]),$('[name="senderAreaName"]').val(aeraArr[2]),$('[name="senderProvinceId"]').val(aeraNumArr[0]),$('[name="senderCityId"]').val(aeraNumArr[1]),$('[name="senderAreaId"]').val(aeraNumArr[2]),$('[name="senderAddress"]').val(detailed);var html='<p id="addr_consigner"> '+company+" <br> "+contact+" "+phone+"  <br>"+aeraArr[0]+" "+aeraArr[1]+" "+aeraArr[2]+" "+detailed+"</p>";$(".consigner_edit a").html(html),$(".self_fa_edit").remove();var receiverAreaId=$('[name="receiverAreaId"]').val();receiverAreaId&&bannce(aeraNumArr[1],aeraNumArr[2],receiverAreaId)&&setTimeout(function(){self_btn_show()},100)}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?($(".selfShipSubmit").removeAttr("disabled"),fubottom("提交失败，请重试")):"timeout"==status&&($(".selfShipSubmit").removeAttr("disabled"),fubottom("提交失败，请重试"))}}),$(".selfShipSubmit").attr("disabled","disabled"),setTimeout(function(){$(".selfShipSubmit").removeAttr("disabled")},5e3)}else AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2],function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("提交中...");var data={userId:userId(),type:1,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],detailed:detailed,lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,isDefault:isDefault,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/add",type:"get",timeout:1e4,dataType:"json",data:data,success:function(data){if(loadingRemove(),data.success){$('[name="senderAddId"]').val(data.info.id),$('[name="senderAddIsDf"]').val(data.info.isDefault),$('[name="senderName"]').val(company),$('[name="senderLinkman"]').val(contact),$('[name="senderMobile"]').val(phone),$('[name="senderProvinceName"]').val(aeraArr[0]),$('[name="senderCityName"]').val(aeraArr[1]),$('[name="senderAreaName"]').val(aeraArr[2]),$('[name="senderProvinceId"]').val(aeraNumArr[0]),$('[name="senderCityId"]').val(aeraNumArr[1]),$('[name="senderAreaId"]').val(aeraNumArr[2]),$('[name="senderAddress"]').val(detailed);var html='<p id="addr_consigner"> '+company+" <br> "+contact+" "+phone+"  <br>"+aeraArr[0]+" "+aeraArr[1]+" "+aeraArr[2]+" "+detailed+"</p>";$(".consigner_edit a").html(html),$(".self_fa_edit").remove();var receiverAreaId=$('[name="receiverAreaId"]').val();receiverAreaId&&bannce(aeraNumArr[1],aeraNumArr[2],receiverAreaId)&&setTimeout(function(){self_btn_show()},100)}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?($(".selfShipSubmit").removeAttr("disabled"),fubottom("提交失败，请重试")):"timeout"==status&&($(".selfShipSubmit").removeAttr("disabled"),fubottom("提交失败，请重试"))}}),$(".selfShipSubmit").attr("disabled","disabled"),setTimeout(function(){$(".selfShipSubmit").removeAttr("disabled")},5e3)}else $.MsgBox.Alert("地址获取失败，请重试或修改地址后再试","确定")})})})}))}function selfConsigner(){var html=template("self_fa_edit");$("body").append(html),$(".self_help_w").animate({right:0},300);var senderName=$('[name="senderName"]').val(),senderLinkman=$('[name="senderLinkman"]').val(),senderMobile=$('[name="senderMobile"]').val(),senderProvinceName=$('[name="senderProvinceName"]').val(),senderCityName=$('[name="senderCityName"]').val(),senderAreaName=$('[name="senderAreaName"]').val(),senderProvinceId=$('[name="senderProvinceId"]').val(),senderCityId=$('[name="senderCityId"]').val(),senderAreaId=$('[name="senderAreaId"]').val(),senderAddress=$('[name="senderAddress"]').val();senderName?($('.consigner_t [name="client"]').val(senderName),$('.consigner_t [name="name"]').val(senderLinkman),$('.consigner_t [name="tel"]').val(senderMobile),$(".consigner_t #addr_aera").html(senderProvinceName+" "+senderCityName+" "+senderAreaName).removeClass("c999"),$('.consigner_t [name="aeraNum"]').val(senderProvinceId+","+senderCityId+","+senderAreaId),$('.consigner_t [name="detail"]').val(senderAddress),addr_aera2(senderProvinceId,senderCityId,senderAreaId)):addr_aera2()}function selfRedSubmit(){if(!noNullfa($('[name="client"]'),"单位名称"))return noNullfa($('[name="client"]'),"单位名称"),!1;if(!telNo($('[name="tel"]')))return telNo($('[name="tel"]')),!1;if(!noNull($('[name="aeraNum"]'),"所在省、市、区"))return noNull($('[name="aeraNum"]'),"所在省、市、区"),!1;if(!noNullfa($('[name="detail"]'),"详细地址"))return noNullfa($('[name="detail"]'),"详细地址"),!1;var company=trim($('[name="client"]').val()),contact=trim($('[name="name"]').val()),phone=trim($('[name="tel"]').val()),aera=$("#addr_aera").html(),aeraNum=$('[name="aeraNum"]').val(),detailed=trim($('[name="detail"]').val()),registerTelLin=($('[name="receiverRegisterCompany"]').val(),$('[name="receiverRegisterMobile"]').val(),$('[name="registerTelLin"]').val()),registerConLin=$('[name="registerConLin"]').val(),receiverIdLin=$('[name="receiverIdLin"]').val(),aeraArr=aera.split(" "),aeraNumArr=aeraNum.split(",");if(senddistinctive()){$('[name="receiverRegisterCompany"]').val(company),registerTelLin&&registerConLin==company?$('[name="receiverRegisterMobile"]').val(registerTelLin):$('[name="receiverRegisterMobile"]').val(""),registerConLin==company?$('[name="receiverId"]').val(receiverIdLin):$('[name="receiverId"]').val(""),$('[name="receiverName"]').val(company),$('[name="receiverLinkman"]').val(contact),$('[name="receiverMobile"]').val(phone),$('[name="receiverProvinceName"]').val(aeraArr[0]),$('[name="receiverCityName"]').val(aeraArr[1]),$('[name="receiverAreaName"]').val(aeraArr[2]),$('[name="receiverProvinceId"]').val(aeraNumArr[0]),$('[name="receiverCityId"]').val(aeraNumArr[1]),$('[name="receiverAreaId"]').val(aeraNumArr[2]),$('[name="receiverAddress"]').val(detailed);var html='<p id="addr_receiver"> '+company+" <br> "+contact+" "+phone+"  <br>"+aeraArr[0]+" "+aeraArr[1]+" "+aeraArr[2]+" "+detailed+"</p>";$(".delivery_edit a").html(html),$(".self_shou_edit,.self_shou_add").remove(),$(".self_shou_edit").remove();var senderCityId=$('[name="senderCityId"]').val(),senderAreaId=$('[name="senderAreaId"]').val();senderAreaId&&bannce(senderCityId,senderAreaId,aeraNumArr[2])&&setTimeout(function(){self_btn_show()},100)}}function selfDelivery(){var html=template("self_shou_add");$("body").append(html),$(".self_help_w").animate({right:0},300);var receiverName=$('[name="receiverName"]').val(),receiverLinkman=$('[name="receiverLinkman"]').val(),receiverMobile=$('[name="receiverMobile"]').val(),receiverProvinceName=$('[name="receiverProvinceName"]').val(),receiverCityName=$('[name="receiverCityName"]').val(),receiverAreaName=$('[name="receiverAreaName"]').val(),receiverProvinceId=$('[name="receiverProvinceId"]').val(),receiverCityId=$('[name="receiverCityId"]').val(),receiverAreaId=$('[name="receiverAreaId"]').val(),receiverAddress=$('[name="receiverAddress"]').val(),receiverRegisterMobile=$('[name="receiverRegisterMobile"]').val(),receiverRegisterCompany=$('[name="receiverRegisterCompany"]').val(),receiverId=$('[name="receiverId"]').val();receiverName?($('.consigner_t [name="client"]').val(receiverName),$('.consigner_t [name="name"]').val(receiverLinkman),$('.consigner_t [name="tel"]').val(receiverMobile),$(".consigner_t #addr_aera").html(receiverProvinceName+" "+receiverCityName+" "+receiverAreaName).removeClass("c999"),$('.consigner_t [name="aeraNum"]').val(receiverProvinceId+","+receiverCityId+","+receiverAreaId),$('.consigner_t [name="detail"]').val(receiverAddress),$('.consigner_t [name="registerTelLin"]').val(receiverRegisterMobile),$('.consigner_t [name="registerConLin"]').val(receiverRegisterCompany),$('.consigner_t [name="receiverIdLin"]').val(receiverId),addr_aera2(receiverProvinceId,receiverCityId,receiverAreaId)):addr_aera2()}function selfshipAddr(data){for(var html="",i=0;i<data.info.length;i++)data.info[i].isDefault?(html+='<div class="record_li ship_li" data-id="'+data.info[i].id+'"><table width="w100"  onclick=addrTrue('+data.info[i].id+')><col width="74%"><col width="20%"><tr><td>发 货 方：'+data.info[i].company+'</td><td class="t_r moren"><span class="red">默认发货</span></td></tr>',data.info[i].contact&&(html+='<tr><td colspan="2">联 系 人：'+data.info[i].contact+"</td></tr>"),html+='<tr><td colspan="2">电&#x3000;&#x3000;话：'+data.info[i].phone+'<br></td></tr><tr><td colspan="2">发货地址：'+data.info[i].proName+data.info[i].cityName+data.info[i].areaName+data.info[i].detailed+'<br></td></tr></table><div class="show_details ov_h"><label class="ship_moren"></label><a class="f_r f14" href="javascript:;" onclick="del_addr($(this),'+data.info[i].id+')">删除</a><a class="f_r f14" onclick="selfConsignerEdit('+data.info[i].id+')" href="javascript:;">编辑</a></div></div>'):(html+='<div class="record_li ship_li" data-id="'+data.info[i].id+'"><table width="w100"   onclick=addrTrue('+data.info[i].id+')><col width="74%"><col width="20%"><tr><td>发 货 方：'+data.info[i].company+'</td><td class="t_r moren"></td></tr>',data.info[i].contact&&(html+='<tr><td colspan="2">联 系 人：'+data.info[i].contact+"</td></tr>"),html+='<tr><td colspan="2">电&#x3000;&#x3000;话：'+data.info[i].phone+'<br></td></tr><tr><td colspan="2">发货地址：'+data.info[i].proName+data.info[i].cityName+data.info[i].areaName+data.info[i].detailed+'<br></td></tr></table></table><div class="show_details ov_h"><label class="ship_moren"><input type="radio"  name="default"><span class="radio"></span>设置为默认发货方</label><a class="f_r f14" href="javascript:;" onclick="del_addr($(this),'+data.info[i].id+')">删除</a><a class="f_r f14" onclick="selfConsignerEdit('+data.info[i].id+')" href="javascript:;">编辑</a></div></div>');$(".record_list").html(html)}function selfAddrsearch(){if(userId()){loading("loading...");var search=$(".search_input").val(),data={userId:userId(),type:1,searchParam:search,requestTokenId:requestTokenId()};search?$.ajax({url:api+"/api/wx/address/find",type:"get",timeout:1e4,dataType:"json",data:data,success:function(data){data.success?data.info.length?selfshipAddr(data):noshipsearch(search):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".record_list"),400,"请求超时，请点击重新获取","selfAddrsearch()"):"timeout"==status&&noResultErr($(".record_list"),400,"请求超时，请点击重新获取","selfAddrsearch()")}}):$.ajax({url:apiL+"/api/wx/address/find",type:"get",timeout:1e4,dataType:"json",data:{userId:userId(),type:1,requestTokenId:requestTokenId()},success:function(data){data.success?data.info.length?selfshipAddr(data):noshipsearch():alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".record_list"),400,"请求超时，请点击重新获取","selfAddrsearch()"):"timeout"==status&&noResultErr($(".record_list"),400,"请求超时，请点击重新获取","selfAddrsearch()")}})}else document.write("请求失败,请返回公众号重新进入")}function selfConsignerBook(){var html=template("self_fa_book");$("body").append(html),$(".self_help_w").animate({right:0},300),userId()?selfConsignerBookA():document.write("请求失败,请返回公众号重新进入")}function selfConsignerBookA(){loading("loading..."),$.ajax({url:apiL+"/api/wx/address/find",type:"get",timeout:1e4,dataType:"json",data:{userId:userId(),type:1,requestTokenId:requestTokenId()},success:function(data){data.success?data.info.length?selfshipAddr(data):noshipsearch():alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".record_list"),400,"请求超时，请点击重新获取","selfConsignerBookA()"):"timeout"==status&&noResultErr($(".record_list"),400,"请求超时，请点击重新获取","selfConsignerBookA()")}})}function noshipsearch(name){name?$(".record_list").html('<div class="ship_nofind"><span><img src="../skin/images/no_find.png" alt=""></span><p>对不起，没有找到“'+name+"”，请重新输入</p></div>"):$(".record_list").html('<div class="ship_nofind"><span><img src="../skin/images/no_find.png" alt=""></span><p>对不起，您还没有添加地址</p></div>')}function addrTrue(id){loading("loading..."),$.ajax({url:apiL+"/api/wx/address/findedit",type:"get",timeout:1e4,dataType:"json",data:{type:1,id:id,requestTokenId:requestTokenId()},success:function(data){if(loadingRemove(),data.success){var info=data.info;if(info.company==$('[name="receiverName"]').val())return $.MsgBox.Alert("发货方与收货方名称不能相同","确定"),!1;if(info.contact)var contact=info.contact;else contact="";$('[name="senderAddId"]').val(id),$('[name="senderAddIsDf"]').val(info.isDefault),$('[name="senderName"]').val(info.company),$('[name="senderLinkman"]').val(contact),$('[name="senderMobile"]').val(info.phone),$('[name="senderProvinceName"]').val(info.proName),$('[name="senderCityName"]').val(info.cityName),$('[name="senderAreaName"]').val(info.areaName),$('[name="senderProvinceId"]').val(info.proNumber),$('[name="senderCityId"]').val(info.cityNumber),$('[name="senderAreaId"]').val(info.areaNumber),$('[name="senderAddress"]').val(info.detailed);var html='<p id="addr_consigner"> '+info.company+" <br> "+contact+" "+info.phone+"  <br>"+info.proName+" "+info.cityName+" "+info.areaName+" "+info.detailed+"</p>";$(".consigner_edit a").html(html),$(".self_fa_book").remove();var receiverAreaId=$('[name="receiverAreaId"]').val();receiverAreaId&&bannce(info.cityNumber,info.areaNumber,receiverAreaId)&&setTimeout(function(){self_btn_show()},100)}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("选取失败，请重试"):"timeout"==status&&fubottom("选取失败，请重试")}})}function recTrue(id){loading("loading..."),$.ajax({url:apiL+"/api/wx/address/findedit",type:"get",timeout:1e4,dataType:"json",data:{type:2,id:id,requestTokenId:requestTokenId()},success:function(data){if(loadingRemove(),data.success){var info=data.info;if(info.company==$('[name="senderName"]').val())return $.MsgBox.Alert("收货方与发货方单位名称不能相同","确定"),!1;$('[name="receiverName"]').val(info.company),$('[name="receiverLinkman"]').val(info.contact),$('[name="receiverMobile"]').val(info.phone),$('[name="receiverProvinceName"]').val(info.proName),$('[name="receiverCityName"]').val(info.cityName),$('[name="receiverAreaName"]').val(info.areaName),$('[name="receiverProvinceId"]').val(info.proNumber),$('[name="receiverCityId"]').val(info.cityNumber),$('[name="receiverAreaId"]').val(info.areaNumber),$('[name="receiverAddress"]').val(info.detailed),$('[name="receiverRegisterMobile"]').val(""),$('[name="receiverRegisterCompany"]').val(""),$('[name="receiverId"]').val("");var html='<p id="addr_receiver"> '+info.company+" <br> ";info.contact&&(html+=info.contact+" "),html+=info.phone+"  <br>"+info.proName+" "+info.cityName+" "+info.areaName+" "+info.detailed+"</p>",$(".delivery_edit a").html(html),$(".self_shou_book").remove();var senderCityId=$('[name="senderCityId"]').val(),senderAreaId=$('[name="senderAreaId"]').val();senderAreaId&&bannce(senderCityId,senderAreaId,info.areaNumber)&&setTimeout(function(){self_btn_show()},100)}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("选取失败，请重试"):"timeout"==status&&fubottom("选取失败，请重试")}})}function del_addr(e,id){$.MsgBox.ConfirmL("确定要删除吗？","取消","确定",function(){loading("删除中..."),$.ajax({url:apiL+"/api/wx/address/findedit",type:"post",timeout:1e4,dataType:"json",data:{id:id,type:1,requestTokenId:requestTokenId()},success:function(data){loadingRemove();var isDefault=data.info.isDefault;data.success?$.ajax({url:apiL+"/api/wx/address/delete",type:"post",timeout:1e4,dataType:"json",data:{type:1,id:id,userId:userId(),isDefault:isDefault,requestTokenId:requestTokenId()},success:function(data1){data1.success?$.ajax({url:apiL+"/api/wx/address/find",type:"get",dataType:"json",data:{userId:userId(),type:1,requestTokenId:requestTokenId()},success:function(data){if(data.success){for(var html="",i=0;i<data.info.length;i++)if(1==data.info[i].isDefault){html='<p id="addr_consigner"> '+data.info[i].company+" <br> "+data.info[i].contact+" "+data.info[i].phone+"  <br>"+data.info[i].proName+" "+data.info[i].cityName+" "+data.info[i].areaName+" "+data.info[i].detailed+"</p>",$(".consigner_edit a").html(html),$('[name="senderAddId"]').val(data.info[i].id),$('[name="senderAddIsDf"]').val(data.info[i].isDefault),$('[name="senderName"]').val(data.info[i].company),$('[name="senderLinkman"]').val(data.info[i].contact),$('[name="senderMobile"]').val(data.info[i].phone),$('[name="senderProvinceName"]').val(data.info[i].proName),$('[name="senderCityName"]').val(data.info[i].cityName),$('[name="senderAreaName"]').val(data.info[i].areaName),$('[name="senderProvinceId"]').val(data.info[i].proNumber),$('[name="senderCityId"]').val(data.info[i].cityNumber),$('[name="senderAreaId"]').val(data.info[i].areaNumber),$('[name="senderAddress"]').val(data.info[i].detailed);var receiverAreaId=$('[name="receiverAreaId"]').val();receiverAreaId&&bannce(data.info[i].cityNumber,data.info[i].areaNumber,receiverAreaId)}0==data.info.length&&($('[name="senderAddId"]').val(""),$('[name="senderAddIsDf"]').val("")),data.info.length?selfshipAddr(data):noshipsearch()}else alert(data.message)}}):alert(data1.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("删除失败，请重试"):"timeout"==status&&fubottom("删除失败，请重试")}}):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("删除失败，请重试"):"timeout"==status&&fubottom("删除失败，请重试")}})},function(){return!1})}function del_rec(e,id){$.MsgBox.ConfirmL("确定要删除吗？","取消","确定",function(){loading("删除中..."),$.ajax({url:apiL+"/api/wx/address/delete",type:"post",timeout:1e4,dataType:"json",data:{type:2,id:id,userId:userId(),isDefault:0,requestTokenId:requestTokenId()},success:function(data){loadingRemove(),data.success?e.parents(".record_li").remove():alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("删除失败，请重试"):"timeout"==status&&fubottom("删除失败，请重试")}})},function(){return!1})}function selfConsignerEdit(id){var html=template("self_fa_edit");$("body").append(html),$(".self_help_w").animate({right:0},300),$(".selfShipSubmit").attr("onclick","selfShipEditSubmit("+id+")"),$(".tacitly_approve").html('<label><input type="checkbox" name="default"><span class="checkbox"></span><b id="">设为默认发货方</b></label>'),loading("获取中..."),$.ajax({url:apiL+"/api/wx/address/findedit",type:"get",timeout:1e4,dataType:"json",data:{type:1,id:id,requestTokenId:requestTokenId()},success:function(data){if(data.success){var info=data.info;$('.consigner_t [name="client"]').val(info.company),$('.consigner_t [name="name"]').val(info.contact),$('.consigner_t [name="tel"]').val(info.phone),$(".consigner_t #addr_aera").html(info.proName+" "+info.cityName+" "+info.areaName).removeClass("c999"),$('.consigner_t [name="aeraNum"]').val(info.proNumber+","+info.cityNumber+","+info.areaNumber),$('.consigner_t [name="detail"]').val(info.detailed),addr_aera2(info.proNumber,info.cityNumber,info.areaNumber),info.isDefault&&$('[name="default"]').attr("checked","checked")}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?$.MsgBox.Alert("获取信息失败，请点击关闭重试","好的"):"timeout"==status&&$.MsgBox.Alert("获取信息失败，请点击关闭重试","好的")}})}function selfShipEditSubmit(id){if(!noNullfa($('[name="client"]'),"单位名称"))return noNullfa($('[name="client"]'),"单位名称"),!1;if(!nameLen($('[name="name"]').val()))return nameLen($('[name="name"]').val()),!1;if(!telNo($('[name="tel"]')))return telNo($('[name="tel"]')),!1;if(!noNull($('[name="aeraNum"]'),"所在省、市、区"))return noNull($('[name="aeraNum"]'),"所在省、市、区"),!1;if(!noNullfa($('[name="detail"]'),"详细地址"))return noNullfa($('[name="detail"]'),"详细地址"),!1;loading("获取中...");var company=trim($('[name="client"]').val()),contact=trim($('[name="name"]').val()),phone=trim($('[name="tel"]').val()),aera=$("#addr_aera").html(),aeraNum=$('[name="aeraNum"]').val(),detailed=trim($('[name="detail"]').val()),aeraArr=aera.split(" "),aeraNumArr=aeraNum.split(","),isDefault="";isDefault=0<$('[name="default"]:checked').length?1:0,AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2]+detailed,function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("获取中...");var data={userId:userId(),type:1,id:id,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],detailed:detailed,lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,isDefault:isDefault,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/edit",type:"get",timeout:1e4,dataType:"json",data:data,success:function(data){loadingRemove(),data.success?$('[name="senderAddId"]').val()==id?Recdistinctive()&&($.ajax({url:apiL+"/api/wx/address/findedit",type:"get",timeout:1e4,dataType:"json",data:{type:1,id:id,requestTokenId:requestTokenId()},success:function(data){if(data.success){var info=data.info;$('[name="senderAddIsDf"]').val(info.isDefault),$('[name="senderName"]').val(info.company),$('[name="senderLinkman"]').val(info.contact),$('[name="senderMobile"]').val(info.phone),$('[name="senderProvinceName"]').val(info.proName),$('[name="senderCityName"]').val(info.cityName),$('[name="senderAreaName"]').val(info.areaName),$('[name="senderProvinceId"]').val(info.proNumber),$('[name="senderCityId"]').val(info.cityNumber),$('[name="senderAreaId"]').val(info.areaNumber),$('[name="senderAddress"]').val(info.detailed);var contact="";contact=info.contact?info.contact:"";var html='<p id="addr_consigner"> '+info.company+" <br> "+contact+" "+info.phone+"  <br>"+info.proName+" "+info.cityName+" "+info.areaName+" "+info.detailed+"</p>";$(".consigner_edit a").html(html);var receiverAreaId=$('[name="receiverAreaId"]').val();receiverAreaId&&bannce(info.cityNumber,info.areaNumber,receiverAreaId)&&setTimeout(function(){self_btn_show()},100),$(".self_fa_edit").remove()}else alert(data.message)},complete:function(XMLHttpRequest,status){return loadingRemove(),"error"==status?fubottom("保存失败，请重试"):"timeout"==status&&fubottom("保存失败，请重试"),!1}}),$.ajax({url:apiL+"/api/wx/address/find",type:"get",timeout:1e4,dataType:"json",data:{userId:userId(),type:1,requestTokenId:requestTokenId()},success:function(data){data.success?data.info.length?selfshipAddr(data):noshipsearch():alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".record_list"),400,"获取列表失败，请点击重新获取","selfConsignerBookA()"):"timeout"==status&&noResultErr($(".record_list"),400,"获取列表失败，请点击重新获取","selfConsignerBookA()")}})):($(".self_fa_edit").remove(),$.ajax({url:apiL+"/api/wx/address/find",type:"get",timeout:1e4,dataType:"json",data:{userId:userId(),type:1,requestTokenId:requestTokenId()},success:function(data){data.success?data.info.length?selfshipAddr(data):noshipsearch():alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".record_list"),400,"获取列表失败，请点击重新获取","selfConsignerBookA()"):"timeout"==status&&noResultErr($(".record_list"),400,"获取列表失败，请点击重新获取","selfConsignerBookA()")}})):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("保存失败，请重试"):"timeout"==status&&fubottom("保存失败，请重试")}})}else AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2],function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("获取中...");var data={userId:userId(),type:1,id:id,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],detailed:detailed,lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,isDefault:isDefault,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/edit",type:"get",timeout:1e4,dataType:"json",data:data,success:function(data){loadingRemove(),data.success?$('[name="senderAddId"]').val()==id?Recdistinctive()&&($.ajax({url:apiL+"/api/wx/address/findedit",type:"get",timeout:1e4,dataType:"json",data:{type:1,id:id,requestTokenId:requestTokenId()},success:function(data){if(data.success){var info=data.info;$('[name="senderAddIsDf"]').val(info.isDefault),$('[name="senderName"]').val(info.company),$('[name="senderLinkman"]').val(info.contact),$('[name="senderMobile"]').val(info.phone),$('[name="senderProvinceName"]').val(info.proName),$('[name="senderCityName"]').val(info.cityName),$('[name="senderAreaName"]').val(info.areaName),$('[name="senderProvinceId"]').val(info.proNumber),$('[name="senderCityId"]').val(info.cityNumber),$('[name="senderAreaId"]').val(info.areaNumber),$('[name="senderAddress"]').val(info.detailed);var contact="";contact=info.contact?info.contact:"";var html='<p id="addr_consigner"> '+info.company+" <br> "+contact+" "+info.phone+"  <br>"+info.proName+" "+info.cityName+" "+info.areaName+" "+info.detailed+"</p>";$(".consigner_edit a").html(html);var receiverAreaId=$('[name="receiverAreaId"]').val();receiverAreaId&&bannce(info.cityNumber,info.areaNumber,receiverAreaId)&&setTimeout(function(){self_btn_show()},100),$(".self_fa_edit").remove()}else alert(data.message)},complete:function(XMLHttpRequest,status){return loadingRemove(),"error"==status?fubottom("保存失败，请重试"):"timeout"==status&&fubottom("保存失败，请重试"),!1}}),$.ajax({url:apiL+"/api/wx/address/find",type:"get",timeout:1e4,dataType:"json",data:{userId:userId(),type:1,requestTokenId:requestTokenId()},success:function(data){data.success?data.info.length?selfshipAddr(data):noshipsearch():alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".record_list"),400,"获取列表失败，请点击重新获取","selfConsignerBookA()"):"timeout"==status&&noResultErr($(".record_list"),400,"获取列表失败，请点击重新获取","selfConsignerBookA()")}})):($(".self_fa_edit").remove(),$.ajax({url:apiL+"/api/wx/address/find",type:"get",timeout:1e4,dataType:"json",data:{userId:userId(),type:1,requestTokenId:requestTokenId()},success:function(data){data.success?data.info.length?selfshipAddr(data):noshipsearch():alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".record_list"),400,"获取列表失败，请点击重新获取","selfConsignerBookA()"):"timeout"==status&&noResultErr($(".record_list"),400,"获取列表失败，请点击重新获取","selfConsignerBookA()")}})):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("保存失败，请重试"):"timeout"==status&&fubottom("保存失败，请重试")}})}else $.MsgBox.Alert("地址获取失败，请重试或修改地址后再试","确定")})})})})}function addFaEdit(){var html=template("self_fa_edit");$("body").append(html),$(".self_help_w").animate({right:0},300),$(".selfShipSubmit").attr("onclick","selfAddShipSubmit()"),addr_aera2()}function selfAddShipSubmit(){if(!noNullfa($('[name="client"]'),"单位名称"))return noNullfa($('[name="client"]'),"单位名称"),!1;if(!telNo($('[name="tel"]')))return telNo($('[name="tel"]')),!1;if(!noNull($('[name="aeraNum"]'),"所在省、市、区"))return noNull($('[name="aeraNum"]'),"所在省、市、区"),!1;if(!noNullfa($('[name="detail"]'),"详细地址"))return noNullfa($('[name="detail"]'),"详细地址"),!1;loading("提交中...");var company=trim($('[name="client"]').val()),contact=trim($('[name="name"]').val()),phone=trim($('[name="tel"]').val()),aera=$("#addr_aera").html(),aeraNum=$('[name="aeraNum"]').val(),detailed=trim($('[name="detail"]').val()),aeraArr=aera.split(" "),aeraNumArr=aeraNum.split(","),isDefault=0;isDefault=0<$('[name="default"]:checked').length?1:0,AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2]+detailed,function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("提交中...");var data={userId:userId(),type:1,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],detailed:detailed,lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,isDefault:isDefault,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/add",type:"get",timeout:1e4,dataType:"json",data:data,success:function(data){loadingRemove(),data.success?($(".self_fa_edit").remove(),$.ajax({url:apiL+"/api/wx/address/find",type:"get",timeout:1e4,dataType:"json",data:{userId:userId(),type:1,requestTokenId:requestTokenId()},success:function(data){data.success?data.info.length?selfshipAddr(data):noshipsearch():alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".record_list"),400,"获取列表失败，请点击重新获取","selfConsignerBookA()"):"timeout"==status&&noResultErr($(".record_list"),400,"获取列表失败，请点击重新获取","selfConsignerBookA()")}})):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("保存失败，请5秒后重试"):"timeout"==status&&fubottom("保存失败，请5秒后重试")}})}else AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2],function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("提交中...");var data={userId:userId(),type:1,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],detailed:detailed,lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,isDefault:isDefault,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/add",type:"get",timeout:1e4,dataType:"json",data:data,success:function(data){loadingRemove(),data.success?($(".self_fa_edit").remove(),$.ajax({url:apiL+"/api/wx/address/find",type:"get",timeout:1e4,dataType:"json",data:{userId:userId(),type:1,requestTokenId:requestTokenId()},success:function(data){data.success?data.info.length?selfshipAddr(data):noshipsearch():alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".record_list"),400,"获取列表失败，请点击重新获取","selfConsignerBookA()"):"timeout"==status&&noResultErr($(".record_list"),400,"获取列表失败，请点击重新获取","selfConsignerBookA()")}})):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("保存失败，请5秒后重试"):"timeout"==status&&fubottom("保存失败，请5秒后重试")}})}else $.MsgBox.Alert("地址获取失败，请重试或修改地址后再试","确定")})})})}),$(".selfShipSubmit").attr("disabled","disabled").css("background","#999"),setTimeout(function(){$(".selfShipSubmit").removeAttr("disabled").css("background","#52BB03")},5e3)}function selfDeliveryBook(){var html=template("self_shou_book");$("body").append(html),$(".self_help_w").animate({right:0},300),userId()?selfDeliveryBookA():document.write("请求失败,请返回公众号重新进入")}function selfDeliveryBookA(){loading("loading..."),$.ajax({url:apiL+"/api/wx/address/find",type:"get",timeout:1e4,dataType:"json",data:{userId:userId(),type:2,requestTokenId:requestTokenId()},success:function(data){data.success?data.info.length?selfReceAddr(data):noshipsearch():alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".record_list"),400,"请求超时，请点击重新获取","selfDeliveryBookA()"):"timeout"==status&&noResultErr($(".record_list"),400,"请求超时，请点击重新获取","selfDeliveryBookA()")}})}function selfAddrShouSearch(){var search=$(".search_input").val();if(loading("loading..."),search){var data={userId:userId(),type:2,searchParam:search,requestTokenId:requestTokenId()};$.ajax({url:api+"/api/wx/address/find",type:"get",timeout:1e4,dataType:"json",data:data,success:function(data){loadingRemove(),data.success?data.info.length?selfReceAddr(data):noshipsearch(search):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".record_list"),400,"获取列表失败，请点击重新获取","selfAddrShouSearch()"):"timeout"==status&&noResultErr($(".record_list"),400,"获取列表失败，请点击重新获取","selfAddrShouSearch()")}})}else $.ajax({url:apiL+"/api/wx/address/find",type:"get",timeout:1e4,dataType:"json",data:{userId:userId(),type:2,requestTokenId:requestTokenId()},success:function(data){loadingRemove(),data.success?data.info.length?selfReceAddr(data):noshipsearch():alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".record_list"),400,"获取列表失败，请点击重新获取","selfAddrShouSearch()"):"timeout"==status&&noResultErr($(".record_list"),400,"获取列表失败，请点击重新获取","selfAddrShouSearch()")}})}function selfReceAddr(data){for(var html="",i=0;i<data.info.length;i++)html+='<div class="record_li ship_li" data-id="'+data.info[i].id+'"><table width="w100" onclick=recTrue("'+data.info[i].id+'")><tr><td>收&nbsp; 货 方：'+data.info[i].company+"</td></tr>",data.info[i].contact&&(html+='<tr><td colspan="2">联&nbsp; 系 人：'+data.info[i].contact+"</td></tr>"),html+='<tr><td colspan="2">电&#x3000;&#x3000;话：'+data.info[i].phone+'<br></td></tr><tr><td colspan="2">收货地址：'+data.info[i].proName+data.info[i].cityName+data.info[i].areaName+data.info[i].detailed+'<br></td></tr></table><div class="show_details ov_h"><a class="f_r f14" href="javascript:;" onclick="del_rec($(this),'+data.info[i].id+')">删除</a><a class="f_r f14" onclick="selfrecrivingEdit('+data.info[i].id+')" href="javascript:;">编辑</a></div></div>';$(".record_list").html(html)}function selfrecrivingEdit(id){var html=template("self_shou_edit");$("body").append(html),$(".self_help_w").animate({right:0},300),$(".selfRedSubmit").attr("onclick","selfRedEditSubmit("+id+")"),$.ajax({url:apiL+"/api/wx/address/findedit",type:"get",timeout:1e4,dataType:"json",data:{type:2,id:id,requestTokenId:requestTokenId()},success:function(data){if(data.success){var info=data.info;$('.consigner_t [name="client"]').val(info.company),$('.consigner_t [name="name"]').val(info.contact),$('.consigner_t [name="tel"]').val(info.phone),$(".consigner_t #addr_aera").html(info.proName+" "+info.cityName+" "+info.areaName).removeClass("c999"),$('.consigner_t [name="aeraNum"]').val(info.proNumber+","+info.cityNumber+","+info.areaNumber),$('.consigner_t [name="detail"]').val(info.detailed),addr_aera2(info.proNumber,info.cityNumber,info.areaNumber)}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?$.MsgBox.Alert("获取信息失败，请点击关闭重试","好的"):"timeout"==status&&$.MsgBox.Alert("获取信息失败，请点击关闭重试","好的")}})}function selfRedEditSubmit(id){if(!noNullfa($('[name="client"]'),"单位名称"))return noNullfa($('[name="client"]'),"单位名称"),!1;if(!nameLen($('[name="name"]').val()))return nameLen($('[name="name"]').val()),!1;if(!telNo($('[name="tel"]')))return telNo($('[name="tel"]')),!1;if(!noNull($('[name="aeraNum"]'),"所在省、市、区"))return noNull($('[name="aeraNum"]'),"所在省、市、区"),!1;if(!noNullfa($('[name="detail"]'),"详细地址"))return noNullfa($('[name="detail"]'),"详细地址"),!1;loading("提交中...");var company=trim($('[name="client"]').val()),contact=trim($('[name="name"]').val()),phone=trim($('[name="tel"]').val()),aera=$("#addr_aera").html(),aeraNum=$('[name="aeraNum"]').val(),detailed=trim($('[name="detail"]').val()),aeraArr=aera.split(" "),aeraNumArr=aeraNum.split(",");AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2]+detailed,function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("提交中...");var data={userId:userId(),type:2,id:id,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],detailed:detailed,lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,isDefault:0,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/edit",type:"get",timeout:1e4,dataType:"json",data:data,success:function(data){loadingRemove(),data.success?($(".self_shou_edit").remove(),$.ajax({url:apiL+"/api/wx/address/find",type:"get",timeout:1e4,dataType:"json",data:{userId:userId(),type:2,requestTokenId:requestTokenId()},success:function(data){data.success?data.info.length?selfReceAddr(data):noshipsearch():alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".record_list"),400,"请求超时，请点击重新获取","selfDeliveryBookA()"):"timeout"==status&&noResultErr($(".record_list"),400,"请求超时，请点击重新获取","selfDeliveryBookA()")}})):alert(data.message)},complete:function(XMLHttpRequest,status){return loadingRemove(),"error"==status?fubottom("保存失败，请重试"):"timeout"==status&&fubottom("保存失败，请重试"),!1}})}else AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2],function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("提交中...");var data={userId:userId(),type:2,id:id,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],detailed:detailed,lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,isDefault:0,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/edit",type:"get",timeout:1e4,dataType:"json",data:data,success:function(data){loadingRemove(),data.success?($(".self_shou_edit").remove(),$.ajax({url:apiL+"/api/wx/address/find",type:"get",timeout:1e4,dataType:"json",data:{userId:userId(),type:2,requestTokenId:requestTokenId()},success:function(data){data.success?data.info.length?selfReceAddr(data):noshipsearch():alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".record_list"),400,"请求超时，请点击重新获取","selfDeliveryBookA()"):"timeout"==status&&noResultErr($(".record_list"),400,"请求超时，请点击重新获取","selfDeliveryBookA()")}})):alert(data.message)},complete:function(XMLHttpRequest,status){return loadingRemove(),"error"==status?fubottom("保存失败，请重试"):"timeout"==status&&fubottom("保存失败，请重试"),!1}})}else $.MsgBox.Alert("地址获取失败，请重试或修改地址后再试","确定")})})})})}function addshouEdit(){var html=template("self_shou_edit");$("body").append(html),$(".self_help_w").animate({right:0},300),$('[name="addBook"]').attr("checked","checked"),$(".selfRedSubmit").attr("onclick","selfAddRedSubmit()"),addr_aera2()}function selfAddRedSubmit(){if(!noNullfa($('[name="client"]'),"单位名称"))return noNullfa($('[name="client"]'),"单位名称"),!1;if(!telNo($('[name="tel"]')))return telNo($('[name="tel"]')),!1;if(!noNull($('[name="aeraNum"]'),"所在省、市、区"))return noNull($('[name="aeraNum"]'),"所在省、市、区"),!1;if(!noNullfa($('[name="detail"]'),"详细地址"))return noNullfa($('[name="detail"]'),"详细地址"),!1;loading("提交中...");var company=trim($('[name="client"]').val()),contact=trim($('[name="name"]').val()),phone=trim($('[name="tel"]').val()),aera=$("#addr_aera").html(),aeraNum=$('[name="aeraNum"]').val(),detailed=trim($('[name="detail"]').val()),aeraArr=aera.split(" "),aeraNumArr=aeraNum.split(",");AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2]+detailed,function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("提交中...");var data={userId:userId(),type:2,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],detailed:detailed,lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,isDefault:0,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/add",type:"post",timeout:1e4,dataType:"json",data:data,success:function(data){loadingRemove(),data.success?($(".self_shou_edit").remove(),$.ajax({url:apiL+"/api/wx/address/find",type:"get",timeout:1e4,dataType:"json",data:{userId:userId(),type:2,requestTokenId:requestTokenId()},success:function(data){data.success?data.info.length?selfReceAddr(data):noshipsearch():alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".record_list"),400,"请求超时，请点击重新获取","selfDeliveryBookA()"):"timeout"==status&&noResultErr($(".record_list"),400,"请求超时，请点击重新获取","selfDeliveryBookA()")}})):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("保存失败，请5秒后重试"):"timeout"==status&&fubottom("保存失败，请5秒后重试")}})}else AMap.service("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(aeraArr[0]+""+aeraArr[1]+aeraArr[2],function(status,result){if(loadingRemove(),"complete"===status&&"OK"===result.info){loading("提交中...");var data={userId:userId(),type:2,company:company,contact:contact,phone:phone,proName:aeraArr[0],proNumber:aeraNumArr[0],cityName:aeraArr[1],cityNumber:aeraNumArr[1],areaName:aeraArr[2],areaNumber:aeraNumArr[2],detailed:detailed,lat:result.geocodes[0].location.lat,lng:result.geocodes[0].location.lng,isDefault:0,requestTokenId:requestTokenId()};$.ajax({url:apiL+"/api/wx/address/add",type:"post",timeout:1e4,dataType:"json",data:data,success:function(data){loadingRemove(),data.success?($(".self_shou_edit").remove(),$.ajax({url:apiL+"/api/wx/address/find",type:"get",timeout:1e4,dataType:"json",data:{userId:userId(),type:2,requestTokenId:requestTokenId()},success:function(data){data.success?data.info.length?selfReceAddr(data):noshipsearch():alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?noResultErr($(".record_list"),400,"请求超时，请点击重新获取","selfDeliveryBookA()"):"timeout"==status&&noResultErr($(".record_list"),400,"请求超时，请点击重新获取","selfDeliveryBookA()")}})):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("保存失败，请5秒后重试"):"timeout"==status&&fubottom("保存失败，请5秒后重试")}})}else $.MsgBox.Alert("地址获取失败，请重试或修改地址后再试","确定")})})})}),$(".selfRedSubmit").attr("disabled","disabled").css("background","#999"),setTimeout(function(){$(".selfRedSubmit").removeAttr("disabled").css("background","#52BB03")},5e3)}function senddistinctive(){var companyName=$('[name="client"]').val();$('[name="tel"]').val();return companyName!=$('[name="senderName"]').val()||(loadingRemove(),$.MsgBox.Alert("收货方与发货方单位名称不能相同","确定"),!1)}function Recdistinctive(){var companyName=$('[name="client"]').val();$('[name="tel"]').val();return companyName!=$('[name="receiverName"]').val()||(loadingRemove(),$.MsgBox.Alert("发货方与收货方单位名称不能相同","确定"),!1)}function sendKeysEnt(){13==event.keyCode&&($(".search_input").blur(),selfAddrsearch())}function recKeysEnt(){13==event.keyCode&&($(".search_input").blur(),selfAddrShouSearch())}function popping(value){0==value.length&&($(".shouTelSearchBg,.shouTelSearch").css("display","block"),$(".searchTel").focus())}function shouTelClose(){$(".searchTel").val(""),$(".shouTelSearchBg,.shouTelSearch").css("display","none")}function shouTelSearch(){if(telNo($('[name="tel"]'))){loading("搜索中...");var tel=$('[name="tel"]').val(),result=(new Base64).decode(sess.info),cityId=(JSON.parse(result),$('[name="senderCityId"]').val()),areaId=$('[name="senderAreaId"]').val();cityId?$.ajax({url:apiAnY+"/api/wx/guest/list/search",type:"get",timeout:1e4,dataType:"json",data:{tel:tel,areaId:areaId,cityId:cityId,requestTokenId:requestTokenId()},success:function(data){if(loadingRemove(),data.success){var info=data.info;if(info instanceof Array)if(0==info.length)$.MsgBox.Alert("未检索到收货方信息<br/>您可修改电话重新搜索，或者直接填写收货方信息","我知道了");else{var html=template("self_shou_list",data);$("body").append(html),$(".self_help_w").animate({right:0},300),$(".findNum span").html(info.length)}else $.MsgBox.Alert("未检索到收货方信息<br/>您可修改电话重新搜索，或者直接填写收货方信息","我知道了")}else alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?fubottom("请求超时，请重试"):"timeout"==status&&fubottom("请求超时，请重试")}}):(loadingRemove(),$.MsgBox.Alert("请先填写发货方信息！","我知道了"))}}function clientele(data){$(".self_shou_add").remove();var html=template("self_shou_add");$("body").append(html),$(".self_help_w").css("right","0"),$('.consigner_t [name="client"]').val(data.guestName),$('.consigner_t [name="name"]').val(data.linkman),$('.consigner_t [name="tel"]').val(data.tel),$(".consigner_t #addr_aera").html(data.provinceName+" "+data.cityName+" "+data.areaName).removeClass("c999"),$('.consigner_t [name="aeraNum"]').val(data.provinceId+","+data.cityId+","+data.areaId),$('.consigner_t [name="detail"]').val(data.address),$('.consigner_t [name="registerTelLin"]').val(data.registerMobile),$('.consigner_t [name="registerConLin"]').val(data.guestName),$('.consigner_t [name="receiverIdLin"]').val(data.receiverId),$(".self_shou_list").remove(),addr_aera2(data.provinceId,data.cityId,data.areaId)}$(function(){userId()?selfLoading():GetQueryString("code")||document.write('<p style="text-align:center;line-height:4rem;font-size:20px;">请在微信三真驿道公众号菜单中打开</p>'),$("label").on("change",".pay_way2",function(event){$(this).attr("checked")?($('[name="have_coll"]').attr("onclick","price_open()"),price_open()):($('[name="have_coll"]').val("").removeAttr("onclick"),$('[name="goodsAmount"]').val("0"),$('[name="payType"]').eq(2).attr("checked")&&$('[name="payType"]').eq(2).removeAttr("checked")),self_btn_show()}),addno();var nearby_li=$(".nearby ul li");1==nearby_li.length&&nearby_li.find(".pay_way").attr("checked","checked"),$("table").on("click",'[name="payType"]:eq(2)',function(event){if($('[name="goodsAmount"]').val()<=0)return alert("未选择代收货款，选择回单付必须要有代收货款哦！"),!1}),$('[name="payType"]').change(function(event){self_btn_show()}),$('[name="goodsQuantity"]').change(function(event){self_btn_show()}),$('[name="goodsName"]').keyup(function(event){self_btn_show()}),$(".nearby").on("click",'[name="inputDotId"]',function(event){self_btn_show()}),setTimeout(function(){self_btn_show()},100)});