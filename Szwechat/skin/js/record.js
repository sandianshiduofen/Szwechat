"use strict";function sendOutList(page){loading("加载中...");GetQueryString("search");var state=GetQueryString("status"),startTimeCuo=GetQueryString("startTime"),endTimeCuo=GetQueryString("endTime"),dataTime=new Date;dataTime.getFullYear(),addZero(dataTime.getMonth()+1),addZero(dataTime.getDate());if(startTimeCuo&&endTimeCuo){var startTime=new Date;startTime.setTime(startTimeCuo);var startTimeShow=startTime.format("yyyy/MM/dd"),startTimeChange=startTime.format("yyyy-MM-dd"),endTime=new Date;endTime.setTime(endTimeCuo);var endTimeShow=endTime.format("yyyy/MM/dd"),endTimeChange=endTime.format("yyyy-MM-dd")}var searchhtml="";if(startTime&&endTime&&(searchhtml='<span class="swiper-slide">'+startTimeShow+"-"+endTimeShow+"</span>"),0===state||state){for(var stateArr=state.split(","),selestStatus="",selestStatusArr=[],i=0;i<stateArr.length;i++)"0"==stateArr[i]?selestStatus="待揽货":1==stateArr[i]?selestStatus="已揽货":2==stateArr[i]?selestStatus="运输中":3==stateArr[i]?selestStatus="配送中":6==stateArr[i]?selestStatus="已签收":4==stateArr[i]?selestStatus="取消发货":5==stateArr[i]?selestStatus="已退货":7==stateArr[i]&&(selestStatus="已驳回"),selestStatusArr.push(selestStatus);for(i=0;i<selestStatusArr.length;i++)searchhtml+='<span  class="swiper-slide">'+selestStatusArr[i]+"</span>"}if($(".swiper-wrapper").html(searchhtml),startTimeCuo&&endTimeCuo||0===state||state){if(stateArr)for(i=0;i<stateArr.length;i++)$('.filtrateTop ul [value="'+stateArr[i]+'"]').attr("checked","checked");$("#date_start").val(startTimeChange),$("#date_end").val(endTimeChange);var data={senderId:number(),pageSize:15,currentPage:page,status:state,startTime:startTimeCuo,endTime:endTimeCuo,requestTokenId:requestTokenId()};$.ajax({url:apiAn+"/api/wx/waybill/selectWaybillForSender",type:"POST",dataType:"json",timeout:1e4,data:data,success:function(data){data.success?(loadingRemove(),sess.sendPages=data.info.pages,correspCon(data.info,startTimeChange,endTimeChange,state)):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?(sess.nowSendPage=1,noResultErr($(".record_list"),400,"请求超时，请点击重新获取","sendOutList(1)"),$(".loading").html("")):"timeout"==status&&(sess.nowSendPage=1,noResultErr($(".record_list"),400,"请求超时，请点击重新获取","sendOutList(1)"),$(".loading").html(""))}})}else $.ajax({url:apiAn+"/api/wx/waybill/selectWaybillForSender",type:"POST",dataType:"json",timeout:1e4,data:{senderId:number(),pageSize:15,currentPage:page,requestTokenId:requestTokenId()},success:function(data){loadingRemove(),data.success?(sess.sendPages=data.info.pages,correspCon(data.info)):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?(sess.nowSendPage=1,noResultErr($(".record_list"),400,"请求超时，请点击重新获取","sendOutList(1)"),$(".loading").html("")):"timeout"==status&&(sess.nowSendPage=1,noResultErr($(".record_list"),400,"请求超时，请点击重新获取","sendOutList(1)"),$(".loading").html(""))}});new Swiper(".swiper-container",{scrollbar:".swiper-scrollbar",scrollbarHide:!0,slidesPerView:"auto",grabCursor:!0});return!0}function corresponSearch(current){for(var dataTime=new Date,statu=(dataTime.getFullYear(),addZero(dataTime.getMonth()+1),addZero(dataTime.getDate()),$('[name="state"]')),statuArr=[],i=0;i<statu.length;i++)statu.eq(i).attr("checked")&&statuArr.push(statu.eq(i).val());var status=statuArr.toString();if(0===status)var statusJ=!0;var startTime=$("#date_start").val(),endTime=$("#date_end").val(),startArr=startTime.split("-"),endArr=endTime.split("-"),startTimeT=new Date(startArr[0],startArr[1]-1,startArr[2]),EndTimeT=new Date(endArr[0],endArr[1]-1,endArr[2],23,59,59),startTimeCuo=startTimeT.getTime(),endTimecuo=EndTimeT.getTime();if(startTimeCuo||(startTimeCuo=""),endTimecuo||(endTimecuo=""),!startTimeCuo&&endTimecuo)return alert("请选择开始日期"),!1;if(startTimeCuo&&!endTimecuo)return alert("请选择截止日期"),!1;if(startTimeCuo&&endTimecuo||statusJ||status)if(startTimeCuo&&endTimecuo&&parseInt(endTimecuo)<parseInt(startTimeCuo))alert("结束日期不可大于开始日期"),$("#date_start").val($("#date_end").val());else{number();window.location.href=window.location.pathname+"?search=1&status="+status+"&startTime="+startTimeCuo+"&endTime="+endTimecuo}else window.location.href=window.location.pathname}function correspCon(info,startTime,endTime,state){var html="";if(info.list){for(var i=0;i<info.list.length;i++){var status=info.list[i].status,statusShow="";"0"==status?statusShow="待揽货":1==status?statusShow="已揽货":2==status?statusShow="运输中":3==status?statusShow="配送中":6==status?statusShow="已签收":4==status?statusShow="取消发货":5==status?statusShow="已退货":7==status&&(statusShow="已驳回"),html+='<div class="record_li" data-id="'+info.list[i].id+'"><table><col width="52%"><col width="24%"><col width="17%"><tr><td colspan="2">揽货网点：'+info.list[i].inputDotName+'</td><td class="t_r"><span class="red">'+statusShow+"</span></td></tr><tr><td>运单编号："+info.list[i].no+'</td><td colspan="2">货物件数：'+info.list[i].goodsQuantity+'</td></tr><tr><td colspan="2">收 货 方：<b>'+info.list[i].receiverName+'</b></td><td><a href="tel:'+info.list[i].receiverMobile+'"><img src="../skin/images/tel.png" alt="电话"></a></td></tr></table><div class="show_details ov_h">',0==info.list[i].status&&(html+='<a class="f_r f14" href="../order/scan.html?order='+info.list[i].no+'">运单条码</a>'),html+='<a class="f_r f14" href="../order/logistics.html?order='+info.list[i].no+'">运单详情</a>',info.list[i].status<4&&(html+='<a class="f_r f14" href="../order/self_help_order.html?waybill='+info.list[i].no+'">修改运单</a>'),html+="</div></div>"}1==info.currentPage?$("#record_list").html(html):$("#record_list").append(html)}else{if($(".loading").html(""),0===state)var statusJ=!0;if(startTime&&endTime||statusJ||state){startTime&&endTime||(endTime=startTime=""),state.length<1&&(state="");var statuArr=state.split(","),stateA=[],statu="";for(i=0;i<statuArr.length;i++)"0"==statuArr[i]?statu="待揽货":1==statuArr[i]?statu="已揽货":2==statuArr[i]?statu="运输中":3==statuArr[i]?statu="配送中":6==statuArr[i]?statu="已签收":4==statuArr[i]?statu="取消发货":5==statuArr[i]?statu="已退货":7==statuArr[i]&&(statu="已驳回"),stateA.push(statu);var statusStr=stateA.toString();$("#record_list").html('<div class="ship_nofind"><span><img src="../skin/images/no_find.png" alt=""></span><p>对不起，没有找到“'+statusStr+startTime+" "+endTime+"”的</br>相关信息，请重新输入。</p></div>")}else $("#record_list").html('<div class="ship_nofind"><span><img src="../skin/images/no_find.png" alt=""></span><p>您还没有发货记录</p></div>')}}function recordOutList(page){loading("加载中...");GetQueryString("search");var state=GetQueryString("status"),startTimeCuo=GetQueryString("startTime"),endTimeCuo=GetQueryString("endTime"),dataTime=new Date;dataTime.getFullYear(),addZero(dataTime.getMonth()+1),addZero(dataTime.getDate());if(startTimeCuo&&endTimeCuo){var startTime=new Date;startTime.setTime(startTimeCuo);var startTimeShow=startTime.format("yyyy/MM/dd"),startTimeChange=startTime.format("yyyy-MM-dd"),endTime=new Date;endTime.setTime(endTimeCuo);var endTimeShow=endTime.format("yyyy/MM/dd"),endTimeChange=endTime.format("yyyy-MM-dd")}var searchhtml="";if(startTime&&endTime&&(searchhtml+='<span class="swiper-slide">'+startTimeShow+"-"+endTimeShow+"</span>"),0===state||state){for(var stateArr=state.split(","),selestStatus="",selestStatusArr=[],i=0;i<stateArr.length;i++)"0"==stateArr[i]?selestStatus="待揽货":1==stateArr[i]?selestStatus="已揽货":2==stateArr[i]?selestStatus="运输中":3==stateArr[i]?selestStatus="配送中":6==stateArr[i]?selestStatus="已签收":4==stateArr[i]?selestStatus="取消发货":5==stateArr[i]?selestStatus="已退货":7==stateArr[i]&&(selestStatus="已驳回"),selestStatusArr.push(selestStatus);for(i=0;i<selestStatusArr.length;i++)searchhtml+='<span class="swiper-slide">'+selestStatusArr[i]+"</span>"}if($(".swiper-wrapper").html(searchhtml),startTimeCuo&&endTimeCuo||"0"==state||state){if(stateArr)for(i=0;i<stateArr.length;i++)$('.filtrateTop ul [value="'+stateArr[i]+'"]').attr("checked","checked");$("#date_start").val(startTimeChange),$("#date_end").val(endTimeChange);var data={pageSize:15,currentPage:page,status:state,startTime:startTimeCuo,endTime:endTimeCuo,receiverId:number(),requestTokenId:requestTokenId()};$.ajax({url:apiAn+"/api/wx/waybill/list/receiver",type:"POST",timeout:1e4,dataType:"json",data:data,success:function(data){data.success?(loadingRemove(),sess.recordPages=data.info.pages,console.log(data),receiveCon(data.info,state,startTimeChange,endTimeChange)):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?(sess.nowRecPage=1,noResultErr($(".record_list"),400,"请求超时，请点击重新获取","recordOutList(1)"),$(".loading").html("")):"timeout"==status&&(sess.nowRecPage=1,noResultErr($(".record_list"),400,"请求超时，请点击重新获取","recordOutList(1)"),$(".loading").html(""))}})}else $.ajax({url:apiAn+"/api/wx/waybill/list/receiver",type:"POST",timeout:1e4,dataType:"json",data:{receiverId:number(),pageSize:15,currentPage:page,requestTokenId:requestTokenId()},success:function(data){data.success?(loadingRemove(),console.log(data),sess.recordPages=data.info.pages,receiveCon(data.info)):alert(data.message)},complete:function(XMLHttpRequest,status){loadingRemove(),"error"==status?(sess.nowRecPage=1,noResultErr($(".record_list"),400,"请求超时，请点击重新获取","recordOutList(1)"),$(".loading").html("")):"timeout"==status&&(sess.nowRecPage=1,noResultErr($(".record_list"),400,"请求超时，请点击重新获取","recordOutList(1)"),$(".loading").html(""))}});new Swiper(".swiper-container",{scrollbar:".swiper-scrollbar",scrollbarHide:!0,slidesPerView:"auto",grabCursor:!0});return!0}function receiveCon(info,status,startTime,endTime){info.pages;var html="";if(info.list){for(var i=0;i<info.list.length;i++){switch(status=info.list[i].status){case 0:status="待揽货";break;case 1:status="已揽货";break;case 2:status="运输中";break;case 3:status="配送中";break;case 4:status="取消发货";break;case 5:status="已退货";break;case 6:status="已签收";break;case 7:status="已驳回"}html+='<div class="record_li"><table><col width="52%"><col width="24%"><col width="17%"><tr><td colspan="2">运单编号：'+info.list[i].no+'</td><td class="t_r"><span class="red">'+status+'</span></td></tr><tr><td colspan="3">货物件数：'+info.list[i].goodsQuantity+'</td></tr><tr><td colspan="2">发 货 方：<b>'+info.list[i].senderName+'</b></td><td><a href="tel:'+info.list[i].senderMobile+'"><img src="../skin/images/tel.png" alt="电话"></a></td></tr></table><div class="show_details ov_h"><a class="f_r f14" href="../order/logistics2.html?order='+info.list[i].no+'">运单详情</a></div></div>'}1==info.currentPage?$("#record_list").html(html):$("#record_list").append(html)}else if($(".loading").html(""),startTime&&endTime||status){startTime&&endTime||(endTime=startTime=""),status.length<1&&(status="");var statuArr=status.split(","),state=[],statu="";for(i=0;i<statuArr.length;i++)statu="0"==statuArr[i]?"未揽货":1==statuArr[i]?"已揽货":2==statuArr[i]?"运输中":3==statuArr[i]?"配送中":6==statuArr[i]?"已签收":4==statuArr[i]?"取消发货":5==statuArr[i]?"已退货":7==statuArr[i]?"已驳回":"",state.push(statu);status=state.toString(),$("#record_list").html('<div class="ship_nofind"><span><img src="../skin/images/no_find.png" alt=""></span><p>对不起，没有找到“'+status+startTime+" "+endTime+"”的</br>相关信息，请重新输入。</p></div>"),$("#Pagination").html("")}else $("#record_list").html('<div class="ship_nofind"><span><img src="../skin/images/no_find.png" alt=""></span><p>您还没有收货记录</p></div>'),$("#Pagination").html("")}function filetrsHide(){$(".protocol_pop_send_w").fadeOut(400),$(".protocol_pop_send").animate({right:"-90%"},400)}function filetrShow(){$(".protocol_pop_send_w").fadeIn(400),$(".protocol_pop_send").animate({right:0},400)}function filetrsReset(){$('[name="state"]').removeAttr("checked"),$(".filetrsTime").val("")}function addZero(input){return input<10?"0"+input:input}function startTime(value){var startArr=value.split("-"),startTimeCuo=new Date(startArr[0],startArr[1]-1,startArr[2]).getTime(),dataTime=new Date,curYear=dataTime.getFullYear(),curMonth=addZero(dataTime.getMonth()+1),curDays=addZero(dataTime.getDate()),curTime=curYear+"-"+curMonth+"-"+curDays;new Date(curYear,curMonth,curDays).getTime()<startTimeCuo&&$("#date_start").val(curTime)}function endTime(value){var endArr=value.split("-"),endTimeCuo=new Date(endArr[0],endArr[1]-1,endArr[2]).getTime(),dataTime=new Date,curYear=dataTime.getFullYear(),curMonth=addZero(dataTime.getMonth()+1),curDays=addZero(dataTime.getDate()),curTime=curYear+"-"+curMonth+"-"+curDays;new Date(curYear,curMonth,curDays).getTime()<endTimeCuo&&$("#date_end").val(curTime)}